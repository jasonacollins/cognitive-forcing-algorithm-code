<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.23">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>cognitive_forcing_0.5</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="cognitive_forcing_0.5_files/libs/clipboard/clipboard.min.js"></script>
<script src="cognitive_forcing_0.5_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="cognitive_forcing_0.5_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="cognitive_forcing_0.5_files/libs/quarto-html/popper.min.js"></script>
<script src="cognitive_forcing_0.5_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="cognitive_forcing_0.5_files/libs/quarto-html/anchor.min.js"></script>
<link href="cognitive_forcing_0.5_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="cognitive_forcing_0.5_files/libs/quarto-html/quarto-syntax-highlighting-226bd0f977fa82dfae4534cac220d79a.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="cognitive_forcing_0.5_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="cognitive_forcing_0.5_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="cognitive_forcing_0.5_files/libs/bootstrap/bootstrap-be9206a58a27969b3ea3001da8f26fef.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="cognitive_forcing_0.5_files/libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="cognitive_forcing_0.5_files/libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="cognitive_forcing_0.5_files/libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">




<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>In this document, we:</p>
<ul>
<li>describe the investment task</li>
<li>analyse the accuracy of a series of algorithms designed to predict the option with the highest expected value</li>
<li>analyse a dataset of people undertaking this task</li>
<li>compare the relative accuracy of the algorithms and humans</li>
</ul>
</section>
<section id="the-investment-task" class="level2">
<h2 class="anchored" data-anchor-id="the-investment-task">The investment task</h2>
<p>Experimental participants choose between:</p>
<ul>
<li>A risk free asset (e.g.&nbsp;a bond) that pays a set amount $<span class="math inline">\(X\)</span> with certainty</li>
<li>A risky asset (e.g.&nbsp;a share) that is good with probability <span class="math inline">\(p\)</span> and bad with probability <span class="math inline">\(1-p\)</span>
<ul>
<li>When the risky asset is good, it pays high ($<span class="math inline">\(Y\)</span>) with probability <span class="math inline">\(q&gt;50\%\)</span> or low ($<span class="math inline">\(Z\)</span>) with probability <span class="math inline">\(1-q\)</span>.</li>
<li>When the risky asset is bad, it pays high ($<span class="math inline">\(Y\)</span>) with probability <span class="math inline">\(1-q\)</span> and low ($<span class="math inline">\(Z\)</span>) with probability <span class="math inline">\(q&gt;50\%\)</span>.</li>
</ul></li>
</ul>
<p>For example:</p>
<ul>
<li>A bond pays $3 with certainty.</li>
<li>The probability of the share being good is 50%.</li>
<li>The good share pays $5 with 70% probability and $1 with 30% probability.</li>
<li>The bad share pays $5 with 30% probability and $1 with 70% probability.</li>
</ul>
<p>The participant makes this decision over a series of investment decisions within a round. The share quality remains the same within a round, enabling the player (or AI) to infer the quality of the share and preferred investment option.</p>
<section id="the-investment-process" class="level3">
<h3 class="anchored" data-anchor-id="the-investment-process">The investment process</h3>
<p>The process runs as follows:</p>
<ul>
<li>The experiment consists of M investment “rounds”</li>
<li>Each round contains N “investment decisions”</li>
<li>At the beginning of each round, the quality of share is drawn in accordance with probability <span class="math inline">\(p\)</span>. The share quality is not revealed to the player or AI. However, the player and AI are informed of the prior probability <span class="math inline">\(p\)</span>. (e.g.&nbsp;the share is good with probability 80%)</li>
<li>For each investment decision in a round, the player makes investment decisions (share or bond) with advice (or not) from an AI and an explanation (or not) of that advice</li>
<li>After each investment decision, the share outcome is drawn in accordance with probability <span class="math inline">\(q\)</span> and the type of share. The outcomes of the risky asset are shown to player, plus their own outcome. Observing the outcome of the risk asset enables the player to infer the share quality and adapt their investment strategy for subsequent investment decisions within the round.</li>
<li>After each round of N investment decisions, investors were shown summary of their payoff for the round</li>
</ul>
<p>At the commencement of the next round, a new quality is drawn for the share</p>
</section>
</section>
<section id="the-artificial-intelligences" class="level2">
<h2 class="anchored" data-anchor-id="the-artificial-intelligences">The artificial intelligences</h2>
<p>Players in all conditions except the control condition have access to investment advice from an AI. The AI is designed to maximise expected return. Each AI does this in a different way (with varying levels of accuracy).</p>
<p>The AIs are:</p>
<ul>
<li>The perfect AI: Maximises expected return using Bayes’s rule.</li>
<li>The conservative AI: Updates insufficiently on new evidence.</li>
<li>The prior-only AI: Does not update on new evidence.</li>
<li>The myopic AI: Only considers the most recent outcome.</li>
<li>The low-memory AI: Only considers the most recent outcome, but updates the prior with the first outcome.</li>
<li>The naive prior AI: Assumes an equal prior for each share type.</li>
</ul>
<p>Where the AI is indifferent between the two options, the AI will inform the player accordingly.</p>
<p>Each AI uses the following equation to calculate the probability that the share is the good share. For a sequence of <span class="math inline">\(n_H\)</span> high payoffs and <span class="math inline">\(n_L\)</span> low payoffs, the posterior probability that the share is good during a block is:</p>
<p><span class="math display">\[
P(\text{good share}|\text{outcomes}) = \frac{p^\alpha \cdot (q^{n_H} \cdot (1-q)^{n_L})^\beta}{p^\alpha \cdot (q^{n_H} \cdot (1-q)^{n_L})^\beta + (1-p)^{\alpha} \cdot ((1-q)^{n_H} \cdot q^{n_L})^\beta}  
\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(p\)</span> = prior probability that the share is the good share</li>
<li><span class="math inline">\(1-p\)</span> = prior probability that the share is the bad share</li>
<li><span class="math inline">\(q\)</span> = probability of high payoff for the good share or low payoff for the bad share</li>
<li><span class="math inline">\(1-q\)</span> = probability of low payoff for the good share or high payoff for the bad share</li>
<li><span class="math inline">\(\alpha\)</span> = parameter that determines the weight given to the prior probability of the share being good (the higher the value, the more weight given to the prior)</li>
<li><span class="math inline">\(\beta\)</span> = parameter that determines the weight given to the likelihood of the observed outcomes (the higher the value, the more weight given to the observed outcomes)</li>
</ul>
<p>Each AI recommends the option that they calculate has the highest expected return. The expected return for the risky asset is:</p>
<p><span class="math display">\[\begin{align*}
E(\text{risky asset}) = P(\text{good share}|\text{outcomes}) \cdot q \cdot Y + P(\text{bad share}|\text{outcomes}) \cdot (1-q) \cdot Y + \\[6pt]
P(\text{good share}|\text{outcomes}) \cdot (1-q) \cdot Z + P(\text{bad share}|\text{outcomes}) \cdot q \cdot Z
\end{align*}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(Y\)</span> = high payoff</li>
<li><span class="math inline">\(Z\)</span> = low payoff</li>
<li><span class="math inline">\(P(\text{good share}|\text{outcomes})\)</span> = posterior probability that the share is good</li>
<li><span class="math inline">\(P(\text{bad share}|\text{outcomes}) = 1-P(\text{good share}|\text{outcomes})\)</span> = posterior probability that the share is bad</li>
</ul>
<p>If expected returns are equal, the AI states that it is indifferent between the two options.</p>
<section id="the-perfect-ai" class="level3">
<h3 class="anchored" data-anchor-id="the-perfect-ai">The perfect AI</h3>
<p>The perfect AI is programmed to maximise expected return using Bayes’s Law. For the perfect AI, <span class="math inline">\(\alpha = 1\)</span> and <span class="math inline">\(\beta = 1\)</span>. The equation therefore simplifies to:</p>
<p><span class="math display">\[  
P(\text{good share}|\text{outcomes}) = \frac{p \cdot q^{n_H} \cdot (1-q)^{n_L}}{p \cdot q^{n_H} \cdot (1-q)^{n_L} + (1-p) \cdot (1-q)^{n_H} \cdot q^{n_L}}  
\]</span></p>
<p>For an experiment where <span class="math inline">\(p=0.5\)</span> and <span class="math inline">\(q = 0.7\)</span>, the equation becomes:</p>
<p><span class="math display">\[
P(\text{good share}|\text{outcomes}) = \frac{0.5 \cdot 0.7^{n_H} \cdot 0.3^{n_L}}{0.5 \cdot 0.7^{n_H} \cdot 0.3^{n_L} + (1-0.5) \cdot 0.3^{n_H} \cdot 0.7^{n_L}}
\]</span></p>
</section>
<section id="the-conservative-ai" class="level3">
<h3 class="anchored" data-anchor-id="the-conservative-ai">The conservative AI</h3>
<p>The conservative AI updates insufficiently on new evidence This is implemented via setting <span class="math inline">\(\alpha=1\)</span> and <span class="math inline">\(\beta=0.5\)</span>. The equation becomes:</p>
<p><span class="math display">\[
P(\text{good share}|\text{outcomes}) = \frac{p \cdot q^{0.5n_H} \cdot (1-q)^{0.5n_L}}{p \cdot q^{0.5n_H} \cdot (1-q)^{0.5n_L} + (1-p) \cdot (1-q)^{0.5n_H} \cdot q^{0.5n_L}}
\]</span></p>
</section>
<section id="the-no-update-ai" class="level3">
<h3 class="anchored" data-anchor-id="the-no-update-ai">The no-update AI</h3>
<p>The no-update AI is a special case of the conservative AI. It does not update on new evidence. This is implemented via setting <span class="math inline">\(\alpha=1\)</span> and <span class="math inline">\(\beta=0\)</span>. The equation becomes:</p>
<p><span class="math display">\[
P(\text{good share}|\text{outcomes}) = \frac{p}{p + (1-p)}=p
\]</span></p>
</section>
<section id="the-low-memory-ai" class="level3">
<h3 class="anchored" data-anchor-id="the-low-memory-ai">The low-memory AI</h3>
<p>The low-memory AI bases its prediction of whether the share is good or bad depending on whether the payoff in the previous period was high or low. If high, predict good. If low, predict bad.</p>
<p>The low-memory AI makes the same prediction as the perfect AI for the first period (before seeing any trials) and often on the first (having a single observation), but it will then vary with variation in the payout more often than the perfect AI.</p>
<p>For the first trial:</p>
<p><span class="math display">\[P(\text{good share}) = p\]</span></p>
<p>For subsequent trials:</p>
<p><span class="math display">\[
P(\text{good share}|\text{previous outcome}) = \begin{cases}
\frac{p \cdot q}{p \cdot q + (1-p) \cdot (1-q)} &amp; {\text{if } \text{previous outcome} = \text{high}} \\[6pt]
\frac{p \cdot (1-q)}{p \cdot (1-q) + (1-p) \cdot q} &amp; {\text{if } \text{previous outcome} = \text{low}} \\[6pt]
\end{cases}
\]</span></p>
</section>
<section id="the-myopic-ai" class="level3">
<h3 class="anchored" data-anchor-id="the-myopic-ai">The myopic AI</h3>
<p>The myopic AI only considers the most recent outcome. Unlike the low-memory AI, which updates the initial prior with the initial outcome, the myopic AI only considers the most recent outcome.</p>
<p>For the first trial:</p>
<p><span class="math display">\[P(\text{good share}) = p\]</span></p>
<p>For subsequent trials:</p>
<p><span class="math display">\[
P(\text{good share}|\text{previous outcome}) = \begin{cases}
q &amp; {\text{if } \text{previous outcome} = \text{high}} \\[6pt]
1-q &amp; {\text{if } \text{previous outcome} = \text{low}} \\[6pt]
\end{cases}
\]</span></p>
</section>
<section id="the-naive-prior" class="level3">
<h3 class="anchored" data-anchor-id="the-naive-prior">The naive prior</h3>
<p>The naive prior AI assumes an equal prior for each share type. This is effectively setting <span class="math inline">\(\alpha = 0\)</span> and <span class="math inline">\(\beta=1\)</span>in the equation above. Therefore, equation for the naive prior AI becomes:</p>
<p><span class="math display">\[
P(\text{good share}|\text{outcomes}) = \frac{q^{n_H} \cdot (1-q)^{n_L}}{q^{n_H} \cdot (1-q)^{n_L} + (1-q)^{n_H} \cdot q^{n_L}}
\]</span></p>
<p>The naive prior AI might make a different prediction to the perfect AI when <span class="math inline">\(p \neq 0.5\)</span>.</p>
</section>
</section>
<section id="investment-algorithm-accuracy-calculation" class="level2">
<h2 class="anchored" data-anchor-id="investment-algorithm-accuracy-calculation">Investment Algorithm Accuracy Calculation</h2>
<p>This notebook simulates the accuracy of different investment algorithms in an uncertain environment. It compares the performance of four different AI models against a benchmark of perfect knowledge. The simulation involves a simple investment task where an agent must decide between investing in a risky asset (a share) or a safe asset (a bond) over multiple trials.</p>
<section id="setup-and-parameters" class="level3">
<h3 class="anchored" data-anchor-id="setup-and-parameters">Setup and Parameters</h3>
<p>This section sets up the necessary libraries and parameters for the simulation.</p>
<ul>
<li>It imports libraries like tidyverse and ggplot.</li>
<li>It sets a random seed for reproducibility.</li>
<li>It defines key parameters such as the prior probabilities of a good share (<code>p</code>), the probability of a high payoff for a good share (<code>q</code>), the payoff values for high and low outcomes (<code>high_payoff</code>, <code>low_payoff</code>), the bond payoff (<code>bond_payoff</code>), the number of investment decisions per round (<code>num_trials</code>), and the number of simulations to run (<code>num_simulations</code>).</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Setup and Parameters</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.2     ✔ tibble    3.2.1
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.0.4     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set random seed for reproducibility</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">20250410</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Configuration list for global parameters</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>simulation_config <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">p =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">0.8</span>),                <span class="co"># Prior probabilities of good share</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">q =</span> <span class="fl">0.7</span>,                             <span class="co"># Probability of high payoff for good share</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">high_payoff =</span> <span class="dv">5</span>,                     <span class="co"># Y value - high payoff amount</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">low_payoff =</span> <span class="dv">1</span>,                      <span class="co"># Z value - low payoff amount</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">bond_payoff =</span> <span class="dv">3</span>,                     <span class="co"># X value - safe bond payoff amount</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">num_trials =</span> <span class="dv">6</span>,                     <span class="co"># Trials per round</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">num_simulations =</span> <span class="dv">1000</span>,             <span class="co"># Number of simulations to run</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">ai_types =</span> <span class="fu">c</span>(<span class="st">"perfect"</span>, <span class="st">"conservative"</span>, <span class="st">"prior_only"</span>, <span class="st">"myopic"</span>, <span class="st">"low_memory"</span>, <span class="st">"naive_prior"</span>),</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta =</span> <span class="fl">0.5</span>                           <span class="co"># Conservatism parameter</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>) {</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">p =</span> p,</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">q =</span> q,</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">high_payoff =</span> high_payoff,</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">low_payoff =</span> low_payoff,</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">bond_payoff =</span> bond_payoff,</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">num_trials =</span> num_trials,</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">num_simulations =</span> num_simulations,</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">ai_types =</span> ai_types,</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">beta =</span> beta</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Create default configuration</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>DEFAULT_CONFIG <span class="ot">&lt;-</span> <span class="fu">simulation_config</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="core-functions" class="level3">
<h3 class="anchored" data-anchor-id="core-functions">Core Functions</h3>
<p>This section defines the core functions for the investment task simulation and analytical solution:</p>
<ul>
<li><code>simulate_outcomes</code>: Simulates the outcomes (high or low) for a given share type (good or bad) over a specified number of trials. It uses the <code>q</code> probability to determine the likelihood of each outcome.</li>
<li><code>calculate_expected_return</code>: Calculates the expected return for the risky asset (share) based on the posterior probability of it being good. This is used to make informed investment decisions.</li>
<li><code>get_correct_decision</code>: Determines the optimal investment decision (share or bond) given the true share type. This represents perfect knowledge and serves as a benchmark for evaluating the AI models.</li>
<li><code>calculate_posterior</code>: Calculates the posterior probability based on the AI type and available information:
<ul>
<li>For ‘perfect’: Uses Bayes’ rule with all available data, representing the ideal scenario with perfect knowledge and reasoning.</li>
<li>For ‘conservative’: Calculates the posterior using a conservative approach, where it updates insufficiently based on the outcomes.</li>
<li>For ‘prior_only’: Assumes the prior probability remains unchanged, representing an AI that does not update its beliefs based on new evidence.</li>
<li>For ‘myopic’: Calculates the posterior based only on the most recent outcome, representing an AI that is short-sighted and only considers the latest information.</li>
<li>For ‘low_memory’: Calculates the posterior based only on the most recent outcome, representing an AI with limited memory or focus.</li>
<li>For ‘naive_prior’: Calculates the posterior using all data but assumes a fixed 50/50 prior, representing an AI with an inaccurate understanding of the prior probabilities.</li>
</ul></li>
<li>the <code>get_ai_recommendation</code> function, which determines the AI’s investment recommendation (share, bond, or indifferent) based on the AI type and the available information.
<ul>
<li>It takes the AI type, prior probability, outcomes so far, and the current trial number as input.</li>
<li>It calculates the posterior probability using the appropriate AI type.</li>
<li>It calculates the expected return based on the posterior.</li>
<li>It compares the expected return to the bond payoff and makes a recommendation accordingly.</li>
</ul></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Investment Task Simulation Functions</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>simulate_outcomes <span class="ot">&lt;-</span> <span class="cf">function</span>(share_type, config) {</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Simulate high/low outcomes for a given share type</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Args:</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   share_type: 'good' or 'bad' - the actual quality of the share</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   config: Simulation configuration parameters</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Returns:</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   Vector of 'high' or 'low' outcomes for each trial</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (share_type <span class="sc">==</span> <span class="st">"good"</span>) {</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    outcomes <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"high"</span>, <span class="st">"low"</span>), <span class="at">size =</span> config<span class="sc">$</span>num_trials, </span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>                      <span class="at">prob =</span> <span class="fu">c</span>(config<span class="sc">$</span>q, <span class="dv">1</span><span class="sc">-</span>config<span class="sc">$</span>q), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(outcomes)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> { <span class="co"># share_type == 'bad'</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    outcomes <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"high"</span>, <span class="st">"low"</span>), <span class="at">size =</span> config<span class="sc">$</span>num_trials, </span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>                      <span class="at">prob =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">-</span>config<span class="sc">$</span>q, config<span class="sc">$</span>q), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(outcomes)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>calculate_expected_return <span class="ot">&lt;-</span> <span class="cf">function</span>(posterior_good, config) {</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate expected return for the risky asset based on posterior probability</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Args:</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   posterior_good: probability that the share is good</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   config: Simulation configuration parameters</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Returns:</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   Expected monetary return of investing in the share</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>  posterior_bad <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> posterior_good</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate expected return using equation from the experiment design</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(posterior_good <span class="sc">*</span> config<span class="sc">$</span>q <span class="sc">*</span> config<span class="sc">$</span>high_payoff <span class="sc">+</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>         posterior_bad <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>config<span class="sc">$</span>q) <span class="sc">*</span> config<span class="sc">$</span>high_payoff <span class="sc">+</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>         posterior_good <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>config<span class="sc">$</span>q) <span class="sc">*</span> config<span class="sc">$</span>low_payoff <span class="sc">+</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>         posterior_bad <span class="sc">*</span> config<span class="sc">$</span>q <span class="sc">*</span> config<span class="sc">$</span>low_payoff)</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a><span class="co"># set tolerance for floating point comparison</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>EPS <span class="ot">&lt;-</span> <span class="fl">1e-10</span>   <span class="co"># or a bit larger, e.g. 1e-9</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>decision_from_ev <span class="ot">&lt;-</span> <span class="cf">function</span>(ev, bond) {</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">abs</span>(ev <span class="sc">-</span> bond) <span class="sc">&lt;</span> EPS) {</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="st">"indifferent"</span>)</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (ev <span class="sc">&gt;</span> bond) {</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="st">"share"</span>)</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="st">"bond"</span>)</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>get_correct_decision <span class="ot">&lt;-</span> <span class="cf">function</span>(true_share_type, config) {</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Determine the correct investment decision given the true share type</span></span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Args:</span></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   true_share_type: 'good' or 'bad' - the actual quality of the share</span></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   config: Simulation configuration parameters</span></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Returns:</span></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   'share' or 'bond' or 'indifferent' - the optimal investment choice</span></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If we know the true share type, posterior probability is either 0 or 1</span></span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>  p_good <span class="ot">&lt;-</span> <span class="cf">if</span>(true_share_type <span class="sc">==</span> <span class="st">"good"</span>) <span class="dv">1</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>  expected_return <span class="ot">&lt;-</span> <span class="fu">calculate_expected_return</span>(p_good, config)</span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">decision_from_ev</span>(expected_return, config<span class="sc">$</span>bond_payoff))</span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>calculate_posterior <span class="ot">&lt;-</span> <span class="cf">function</span>(ai_type, p, outcomes, current_trial, config) {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate posterior probability based on AI type and available information</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Args:</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   ai_type: 'perfect', 'conservative', 'prior_only', 'myopic', 'low_memory', or 'naive_prior'</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   p: prior probability of good share</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   outcomes: vector of all outcomes so far</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   current_trial: the current trial number (0-indexed)</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   config: Simulation configuration parameters</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Returns:</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   Updated probability that the share is good</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># For naive prior with no outcomes, always use 0.5</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (ai_type <span class="sc">==</span> <span class="st">"naive_prior"</span> <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(outcomes) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fl">0.5</span>)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># With no observations, return the prior (except for naive_prior handled above)</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(outcomes) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(p)  <span class="co"># No evidence yet, return the prior for other models</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Handle different AI types</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (ai_type <span class="sc">==</span> <span class="st">"myopic"</span>) {</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Myopic AI only considers the most recent outcome with fixed probabilities</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>    most_recent <span class="ot">&lt;-</span> outcomes[<span class="fu">length</span>(outcomes)]</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (most_recent <span class="sc">==</span> <span class="st">"high"</span>) {</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(config<span class="sc">$</span>q)  <span class="co"># Probability of high given good</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="dv">1</span> <span class="sc">-</span> config<span class="sc">$</span>q)  <span class="co"># Probability of low given good</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (ai_type <span class="sc">==</span> <span class="st">"low_memory"</span>) {</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Low_memory AI only considers the most recent outcome (with Bayesian update from prior)</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>    outcomes <span class="ot">&lt;-</span> outcomes[<span class="fu">length</span>(outcomes)]</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (ai_type <span class="sc">==</span> <span class="st">"prior_only"</span>) {</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Prior_only AI only uses the prior probability</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(p)</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (ai_type <span class="sc">==</span> <span class="st">"naive_prior"</span>) {</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Naïve prior AI uses all data but always assumes a 50/50 prior</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Count high and low outcomes</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>  nH <span class="ot">&lt;-</span> <span class="fu">sum</span>(outcomes <span class="sc">==</span> <span class="st">"high"</span>)</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>  nL <span class="ot">&lt;-</span> <span class="fu">length</span>(outcomes) <span class="sc">-</span> nH</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate posterior using Bayes' rule</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (ai_type <span class="sc">==</span> <span class="st">"conservative"</span>) {</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Conservative AI updates insufficiently</span></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>    numerator <span class="ot">&lt;-</span> p <span class="sc">*</span> ((config<span class="sc">$</span>q <span class="sc">^</span> nH) <span class="sc">*</span> ((<span class="dv">1</span><span class="sc">-</span>config<span class="sc">$</span>q) <span class="sc">^</span> nL)) <span class="sc">^</span> config<span class="sc">$</span>beta</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>    denominator <span class="ot">&lt;-</span> numerator <span class="sc">+</span> (<span class="dv">1</span><span class="sc">-</span>p) <span class="sc">*</span> (((<span class="dv">1</span><span class="sc">-</span>config<span class="sc">$</span>q) <span class="sc">^</span> nH) <span class="sc">*</span> (config<span class="sc">$</span>q <span class="sc">^</span> nL)) <span class="sc">^</span> config<span class="sc">$</span>beta</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (ai_type <span class="sc">==</span> <span class="st">"prior_only"</span>) {</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># No update AI doesn't use any outcomes</span></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(p)</span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Standard Bayesian update for other AI types</span></span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>    numerator <span class="ot">&lt;-</span> p <span class="sc">*</span> (config<span class="sc">$</span>q <span class="sc">^</span> nH) <span class="sc">*</span> ((<span class="dv">1</span><span class="sc">-</span>config<span class="sc">$</span>q) <span class="sc">^</span> nL)</span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>    denominator <span class="ot">&lt;-</span> numerator <span class="sc">+</span> (<span class="dv">1</span><span class="sc">-</span>p) <span class="sc">*</span> ((<span class="dv">1</span><span class="sc">-</span>config<span class="sc">$</span>q) <span class="sc">^</span> nH) <span class="sc">*</span> (config<span class="sc">$</span>q <span class="sc">^</span> nL)</span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="cf">if</span>(denominator <span class="sc">!=</span> <span class="dv">0</span>) numerator <span class="sc">/</span> denominator <span class="cf">else</span> p)</span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>get_ai_recommendation <span class="ot">&lt;-</span> <span class="cf">function</span>(ai_type, p, outcomes, current_trial, config) {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Determine AI's recommendation based on AI type and available information</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Args:</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   ai_type: AI model type</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   p: prior probability of good share</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   outcomes: vector of all outcomes so far</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   current_trial: the current trial number (0-indexed)</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   config: Simulation configuration parameters</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Returns:</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   'share', 'bond', or 'indifferent' - the AI's recommendation</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate posterior probability based on AI type</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  posterior_good <span class="ot">&lt;-</span> <span class="fu">calculate_posterior</span>(ai_type, p, outcomes, current_trial, config)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate expected return and make recommendation</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  expected_return <span class="ot">&lt;-</span> <span class="fu">calculate_expected_return</span>(posterior_good, config)</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">decision_from_ev</span>(expected_return, config<span class="sc">$</span>bond_payoff))</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="metric-calculation-functions" class="level2">
<h2 class="anchored" data-anchor-id="metric-calculation-functions">Metric calculation functions</h2>
<p>It calculates exact probabilities for all possible outcome sequences rather than using simulation.</p>
<ol type="1">
<li><p><strong>Ex-Ante correctness</strong>: Evaluates if the AI’s recommendation matches the optimal decision based on perfect Bayesian reasoning given available information. It measures statistical optimality regardless of outcome.</p></li>
<li><p><strong>Ex-Post Type correctness</strong>: Evaluates if the AI’s recommendation matches what would have been optimal given perfect knowledge of the share type (good vs bad). This measures alignment with the true underlying asset quality.</p></li>
<li><p><strong>Ex-Post Payoff correctness</strong>: Evaluates if the AI’s recommendation maximized payoff given the actual outcome (high vs low). This measures whether the decision was rewarded by the specific outcome that occurred.</p></li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>measure_ex_ante_correctness <span class="ot">&lt;-</span> <span class="cf">function</span>(ai_rec, true_bayes_post, config) {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1) Ex-Ante correctness = does the AI's action match the *fully* Bayesian (perfect) EV?</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#    - If EV(share) &gt; bond =&gt; share is correct</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#    - If EV(share) &lt; bond =&gt; bond  is correct</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#    - If tie =&gt; indifferent is correct</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  ev_share_correct <span class="ot">&lt;-</span> <span class="fu">calculate_expected_return</span>(true_bayes_post, config)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">abs</span>(ev_share_correct <span class="sc">-</span> config<span class="sc">$</span>bond_payoff) <span class="sc">&lt;</span> <span class="fl">1e-10</span>) {</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Perfect tie =&gt; only indifferent gets full credit</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cf">if</span>(ai_rec <span class="sc">==</span> <span class="st">"indifferent"</span>) <span class="fl">1.0</span> <span class="cf">else</span> <span class="fl">0.0</span>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (ev_share_correct <span class="sc">&gt;</span> config<span class="sc">$</span>bond_payoff) {</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cf">if</span>(ai_rec <span class="sc">==</span> <span class="st">"share"</span>) <span class="fl">1.0</span> <span class="cf">else</span> <span class="fl">0.0</span>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cf">if</span>(ai_rec <span class="sc">==</span> <span class="st">"bond"</span>) <span class="fl">1.0</span> <span class="cf">else</span> <span class="fl">0.0</span>)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>measure_ex_post_share_type <span class="ot">&lt;-</span> <span class="cf">function</span>(ai_rec, share_type) {</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2) Old Ex-post measure (share-type):</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  <span class="co">#    - If share is good =&gt; share=1, bond=0, indifferent=0.5</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">#    - If share is bad  =&gt; bond=1, share=0, indifferent=0.5</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (share_type <span class="sc">==</span> <span class="st">"good"</span>) {</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (ai_rec <span class="sc">==</span> <span class="st">"share"</span>) {</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fl">1.0</span>)</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (ai_rec <span class="sc">==</span> <span class="st">"indifferent"</span>) {</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fl">0.5</span>)</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> { <span class="co"># bond</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fl">0.0</span>)</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> { <span class="co"># bad</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (ai_rec <span class="sc">==</span> <span class="st">"bond"</span>) {</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fl">1.0</span>)</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (ai_rec <span class="sc">==</span> <span class="st">"indifferent"</span>) {</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fl">0.5</span>)</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> { <span class="co"># share</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fl">0.0</span>)</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>measure_ex_post_payoff <span class="ot">&lt;-</span> <span class="cf">function</span>(ai_rec, outcome) {</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 3) Payoff-based ex-post:</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>  <span class="co">#    If outcome='high' =&gt; share=1, bond=0, indifferent=0.5</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>  <span class="co">#    If outcome='low'  =&gt; bond=1, share=0, indifferent=0.5</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (outcome <span class="sc">==</span> <span class="st">"high"</span>) {</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (ai_rec <span class="sc">==</span> <span class="st">"share"</span>) {</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fl">1.0</span>)</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (ai_rec <span class="sc">==</span> <span class="st">"bond"</span>) {</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fl">0.0</span>)</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> { <span class="co"># indifferent</span></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fl">0.5</span>)</span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> { <span class="co"># 'low'</span></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (ai_rec <span class="sc">==</span> <span class="st">"bond"</span>) {</span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fl">1.0</span>)</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (ai_rec <span class="sc">==</span> <span class="st">"share"</span>) {</span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fl">0.0</span>)</span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fl">0.5</span>)</span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate all accuracy metrics for an AI recommendation</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>calculate_accuracy_metrics <span class="ot">&lt;-</span> <span class="cf">function</span>(ai_rec, true_posterior, true_share_type, </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                                      outcome, ev_optimal, <span class="at">config =</span> DEFAULT_CONFIG) {</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate all three accuracy metrics for an AI recommendation</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Args:</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   ai_rec: AI recommendation ('share', 'bond', or 'indifferent')</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   true_posterior: True Bayesian posterior probability of good share</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   true_share_type: Actual share type ('good' or 'bad')</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   outcome: Actual outcome ('high' or 'low')</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   ev_optimal: Statistically optimal decision ('share', 'bond', or 'indifferent')</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   config: Simulation configuration parameters</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Returns:</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   List containing all three accuracy metrics</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1. Ex-ante accuracy (statistical optimality)</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  ex_ante <span class="ot">&lt;-</span> <span class="fu">measure_ex_ante_correctness</span>(ai_rec, true_posterior, config)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2. Ex-post type accuracy (share-type correctness)</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  ex_post_type <span class="ot">&lt;-</span> <span class="fu">measure_ex_post_share_type</span>(ai_rec, true_share_type)</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 3. Ex-post payoff accuracy (outcome-based)</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  ex_post_payoff <span class="ot">&lt;-</span> <span class="fu">measure_ex_post_payoff</span>(ai_rec, outcome)</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">ex_ante =</span> ex_ante,</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">ex_post_type =</span> ex_post_type,</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">ex_post_payoff =</span> ex_post_payoff</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Correctness measures excluding when equal EV</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>measure_ex_ante_forced_choice <span class="ot">&lt;-</span> <span class="cf">function</span>(ai_rec, true_bayes_post, config) {</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ex-Ante correctness excluding EV ties</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Args:</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   ai_rec: AI recommendation</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   true_bayes_post: True Bayesian posterior</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   config: Simulation configuration</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Returns:</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   List with accuracy and should_include flag</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>  ev_share <span class="ot">&lt;-</span> <span class="fu">calculate_expected_return</span>(true_bayes_post, config)</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if it's a tie (EV equal to bond payoff)</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>  is_tie <span class="ot">&lt;-</span> <span class="fu">abs</span>(ev_share <span class="sc">-</span> config<span class="sc">$</span>bond_payoff) <span class="sc">&lt;</span> <span class="fl">1e-10</span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If this is a tie, exclude this case</span></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (is_tie) {</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">accuracy =</span> <span class="fl">0.0</span>, <span class="at">should_include =</span> <span class="cn">FALSE</span>))</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Otherwise, standard scoring</span></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (ev_share <span class="sc">&gt;</span> config<span class="sc">$</span>bond_payoff) {</span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>    accuracy <span class="ot">&lt;-</span> <span class="cf">if</span>(ai_rec <span class="sc">==</span> <span class="st">"share"</span>) <span class="fl">1.0</span> <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> { <span class="co"># ev_share &lt; config$bond_payoff</span></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>    accuracy <span class="ot">&lt;-</span> <span class="cf">if</span>(ai_rec <span class="sc">==</span> <span class="st">"bond"</span>) <span class="fl">1.0</span> <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">accuracy =</span> accuracy, <span class="at">should_include =</span> <span class="cn">TRUE</span>))</span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="simulation-analysis" class="level3">
<h3 class="anchored" data-anchor-id="simulation-analysis">Simulation analysis</h3>
<p>This section defines functions for running the simulations and aggregating the results:</p>
<ul>
<li><code>run_simulation</code>: Runs a single simulation of the investment task for a given prior probability (<code>p</code>). It simulates outcomes, calculates the correct decision, tracks the AI recommendations, and calculates accuracy metrics.</li>
<li><code>run_all_simulations</code>: Runs simulations for all prior probabilities (<code>p</code>) and aggregates the results across multiple simulations.</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulation Runner Functions</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>run_simulation <span class="ot">&lt;-</span> <span class="cf">function</span>(p, sim_id, config) {</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Run a single simulation of the investment task</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Args:</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   p: Prior probability of good share</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   sim_id: Simulation ID</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   config: Simulation configuration parameters</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Returns:</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   List containing:</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   - ai_metrics: List of AI performance metrics</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   - detailed_data: Dataframe of detailed trial data</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Determine if the share is good or bad based on prior probability</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  share_type <span class="ot">&lt;-</span> <span class="cf">if</span>(<span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">&lt;</span> p) <span class="st">"good"</span> <span class="cf">else</span> <span class="st">"bad"</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Simulate outcomes for all trials</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  outcomes <span class="ot">&lt;-</span> <span class="fu">simulate_outcomes</span>(share_type, config)</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the correct decision based on the true share type</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>  correct_decision <span class="ot">&lt;-</span> <span class="fu">get_correct_decision</span>(share_type, config)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Track recommendations and metrics for each AI type</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>  ai_metrics <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (ai_type <span class="cf">in</span> config<span class="sc">$</span>ai_types) {</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    ai_metrics[[ai_type]] <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">ex_ante =</span> <span class="dv">0</span>,</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">ex_post_type =</span> <span class="dv">0</span>,</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">ex_post_payoff =</span> <span class="dv">0</span>,</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">forced_correct =</span> <span class="dv">0</span>,</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">forced_type_correct =</span> <span class="dv">0</span>,</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">forced_payoff_correct =</span> <span class="dv">0</span>,</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">forced_total =</span> <span class="dv">0</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>  total_rows <span class="ot">&lt;-</span> config<span class="sc">$</span>num_trials <span class="sc">*</span> <span class="fu">length</span>(config<span class="sc">$</span>ai_types)</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>  detailed_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">sim_id =</span> <span class="fu">numeric</span>(total_rows),</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior =</span> <span class="fu">numeric</span>(total_rows),</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">trial =</span> <span class="fu">numeric</span>(total_rows),</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">ai_type =</span> <span class="fu">character</span>(total_rows),</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">true_share_type =</span> <span class="fu">character</span>(total_rows),</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome =</span> <span class="fu">character</span>(total_rows),</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">ai_rec =</span> <span class="fu">character</span>(total_rows),</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">ev_optimal =</span> <span class="fu">character</span>(total_rows),</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">ev_accuracy =</span> <span class="fu">numeric</span>(total_rows),</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">rec_accuracy =</span> <span class="fu">numeric</span>(total_rows),</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome_accuracy =</span> <span class="fu">numeric</span>(total_rows),</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">forced_accuracy =</span> <span class="fu">numeric</span>(total_rows),</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_ev_tie =</span> <span class="fu">logical</span>(total_rows),</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>  row_index <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Simulate AI recommendations at each trial</span></span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (trial <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>config<span class="sc">$</span>num_trials) {</span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get outcomes observed so far (excluding current trial)</span></span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>    observed_outcomes <span class="ot">&lt;-</span> <span class="cf">if</span>(trial <span class="sc">&gt;</span> <span class="dv">1</span>) outcomes[<span class="dv">1</span><span class="sc">:</span>(trial<span class="dv">-1</span>)] <span class="cf">else</span> <span class="fu">character</span>(<span class="dv">0</span>)</span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>    current_outcome <span class="ot">&lt;-</span> outcomes[trial]</span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get true Bayesian posterior for EV measure</span></span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>    true_posterior <span class="ot">&lt;-</span> <span class="fu">calculate_posterior</span>(<span class="st">"perfect"</span>, p, observed_outcomes, trial<span class="dv">-1</span>, config)</span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate expected return based on true posterior</span></span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>    expected_return <span class="ot">&lt;-</span> <span class="fu">calculate_expected_return</span>(true_posterior, config)</span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Determine optimal decision based on expected return</span></span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>    ev_optimal_decision <span class="ot">&lt;-</span> <span class="cf">if</span>(expected_return <span class="sc">&gt;</span> config<span class="sc">$</span>bond_payoff) {</span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>      <span class="st">"share"</span></span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span>(expected_return <span class="sc">&lt;</span> config<span class="sc">$</span>bond_payoff) {</span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>      <span class="st">"bond"</span></span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>      <span class="st">"indifferent"</span></span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For each AI type, get recommendation and measure correctness</span></span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (ai_type <span class="cf">in</span> config<span class="sc">$</span>ai_types) {</span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a>      ai_rec <span class="ot">&lt;-</span> <span class="fu">get_ai_recommendation</span>(ai_type, p, observed_outcomes, trial<span class="dv">-1</span>, config)</span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Ex-Ante correctness (match with statistical optimality)</span></span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a>      ex_ante_correct <span class="ot">&lt;-</span> <span class="fu">measure_ex_ante_correctness</span>(ai_rec, true_posterior, config)</span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Ex-Post Type correctness (match with true share type)</span></span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a>      ex_post_type_correct <span class="ot">&lt;-</span> <span class="fu">measure_ex_post_share_type</span>(ai_rec, share_type)</span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Ex-Post Payoff correctness (match with actual outcome)</span></span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a>      ex_post_payoff_correct <span class="ot">&lt;-</span> <span class="fu">measure_ex_post_payoff</span>(ai_rec, current_outcome)</span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Forced choice Ex-Ante correctness (excluding ties)</span></span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a>      is_ev_tie <span class="ot">&lt;-</span> <span class="fu">abs</span>(expected_return <span class="sc">-</span> config<span class="sc">$</span>bond_payoff) <span class="sc">&lt;</span> <span class="fl">1e-10</span></span>
<span id="cb9-95"><a href="#cb9-95" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb9-96"><a href="#cb9-96" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (is_ev_tie) {</span>
<span id="cb9-97"><a href="#cb9-97" aria-hidden="true" tabindex="-1"></a>        forced_correct <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb9-98"><a href="#cb9-98" aria-hidden="true" tabindex="-1"></a>        should_include <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb9-99"><a href="#cb9-99" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb9-100"><a href="#cb9-100" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Standard scoring</span></span>
<span id="cb9-101"><a href="#cb9-101" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (expected_return <span class="sc">&gt;</span> config<span class="sc">$</span>bond_payoff) {</span>
<span id="cb9-102"><a href="#cb9-102" aria-hidden="true" tabindex="-1"></a>          forced_correct <span class="ot">&lt;-</span> <span class="cf">if</span>(ai_rec <span class="sc">==</span> <span class="st">"share"</span>) <span class="fl">1.0</span> <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb9-103"><a href="#cb9-103" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> { <span class="co"># expected_return &lt; config$bond_payoff</span></span>
<span id="cb9-104"><a href="#cb9-104" aria-hidden="true" tabindex="-1"></a>          forced_correct <span class="ot">&lt;-</span> <span class="cf">if</span>(ai_rec <span class="sc">==</span> <span class="st">"bond"</span>) <span class="fl">1.0</span> <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb9-105"><a href="#cb9-105" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb9-106"><a href="#cb9-106" aria-hidden="true" tabindex="-1"></a>        should_include <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb9-107"><a href="#cb9-107" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb9-108"><a href="#cb9-108" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb9-109"><a href="#cb9-109" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Add to metrics</span></span>
<span id="cb9-110"><a href="#cb9-110" aria-hidden="true" tabindex="-1"></a>      ai_metrics[[ai_type]]<span class="sc">$</span>ex_ante <span class="ot">&lt;-</span> ai_metrics[[ai_type]]<span class="sc">$</span>ex_ante <span class="sc">+</span> ex_ante_correct</span>
<span id="cb9-111"><a href="#cb9-111" aria-hidden="true" tabindex="-1"></a>      ai_metrics[[ai_type]]<span class="sc">$</span>ex_post_type <span class="ot">&lt;-</span> ai_metrics[[ai_type]]<span class="sc">$</span>ex_post_type <span class="sc">+</span> ex_post_type_correct</span>
<span id="cb9-112"><a href="#cb9-112" aria-hidden="true" tabindex="-1"></a>      ai_metrics[[ai_type]]<span class="sc">$</span>ex_post_payoff <span class="ot">&lt;-</span> ai_metrics[[ai_type]]<span class="sc">$</span>ex_post_payoff <span class="sc">+</span> ex_post_payoff_correct</span>
<span id="cb9-113"><a href="#cb9-113" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb9-114"><a href="#cb9-114" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Only include in forced choice metric if it's not a tie</span></span>
<span id="cb9-115"><a href="#cb9-115" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (should_include) {</span>
<span id="cb9-116"><a href="#cb9-116" aria-hidden="true" tabindex="-1"></a>        ai_metrics[[ai_type]]<span class="sc">$</span>forced_correct <span class="ot">&lt;-</span> ai_metrics[[ai_type]]<span class="sc">$</span>forced_correct <span class="sc">+</span> forced_correct</span>
<span id="cb9-117"><a href="#cb9-117" aria-hidden="true" tabindex="-1"></a>        ai_metrics[[ai_type]]<span class="sc">$</span>forced_type_correct <span class="ot">&lt;-</span> ai_metrics[[ai_type]]<span class="sc">$</span>forced_type_correct <span class="sc">+</span> ex_post_type_correct</span>
<span id="cb9-118"><a href="#cb9-118" aria-hidden="true" tabindex="-1"></a>        ai_metrics[[ai_type]]<span class="sc">$</span>forced_payoff_correct <span class="ot">&lt;-</span> ai_metrics[[ai_type]]<span class="sc">$</span>forced_payoff_correct <span class="sc">+</span> ex_post_payoff_correct</span>
<span id="cb9-119"><a href="#cb9-119" aria-hidden="true" tabindex="-1"></a>        ai_metrics[[ai_type]]<span class="sc">$</span>forced_total <span class="ot">&lt;-</span> ai_metrics[[ai_type]]<span class="sc">$</span>forced_total <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb9-120"><a href="#cb9-120" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb9-121"><a href="#cb9-121" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb9-122"><a href="#cb9-122" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Record detailed data for this trial</span></span>
<span id="cb9-123"><a href="#cb9-123" aria-hidden="true" tabindex="-1"></a>      detailed_data[row_index, ] <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb9-124"><a href="#cb9-124" aria-hidden="true" tabindex="-1"></a>        <span class="at">sim_id =</span> sim_id,</span>
<span id="cb9-125"><a href="#cb9-125" aria-hidden="true" tabindex="-1"></a>        <span class="at">prior =</span> p,</span>
<span id="cb9-126"><a href="#cb9-126" aria-hidden="true" tabindex="-1"></a>        <span class="at">trial =</span> trial,</span>
<span id="cb9-127"><a href="#cb9-127" aria-hidden="true" tabindex="-1"></a>        <span class="at">ai_type =</span> ai_type,</span>
<span id="cb9-128"><a href="#cb9-128" aria-hidden="true" tabindex="-1"></a>        <span class="at">true_share_type =</span> share_type,</span>
<span id="cb9-129"><a href="#cb9-129" aria-hidden="true" tabindex="-1"></a>        <span class="at">outcome =</span> current_outcome,</span>
<span id="cb9-130"><a href="#cb9-130" aria-hidden="true" tabindex="-1"></a>        <span class="at">ai_rec =</span> ai_rec,</span>
<span id="cb9-131"><a href="#cb9-131" aria-hidden="true" tabindex="-1"></a>        <span class="at">ev_optimal =</span> ev_optimal_decision,</span>
<span id="cb9-132"><a href="#cb9-132" aria-hidden="true" tabindex="-1"></a>        <span class="at">ev_accuracy =</span> ex_ante_correct,</span>
<span id="cb9-133"><a href="#cb9-133" aria-hidden="true" tabindex="-1"></a>        <span class="at">rec_accuracy =</span> ex_post_type_correct,</span>
<span id="cb9-134"><a href="#cb9-134" aria-hidden="true" tabindex="-1"></a>        <span class="at">outcome_accuracy =</span> ex_post_payoff_correct,</span>
<span id="cb9-135"><a href="#cb9-135" aria-hidden="true" tabindex="-1"></a>        <span class="at">forced_accuracy =</span> <span class="cf">if</span>(should_include) forced_correct <span class="cf">else</span> <span class="cn">NA</span>,</span>
<span id="cb9-136"><a href="#cb9-136" aria-hidden="true" tabindex="-1"></a>        <span class="at">is_ev_tie =</span> <span class="sc">!</span>should_include</span>
<span id="cb9-137"><a href="#cb9-137" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb9-138"><a href="#cb9-138" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb9-139"><a href="#cb9-139" aria-hidden="true" tabindex="-1"></a>      row_index <span class="ot">&lt;-</span> row_index <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb9-140"><a href="#cb9-140" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-141"><a href="#cb9-141" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-142"><a href="#cb9-142" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-143"><a href="#cb9-143" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert trial sums to averages</span></span>
<span id="cb9-144"><a href="#cb9-144" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (ai_type <span class="cf">in</span> config<span class="sc">$</span>ai_types) {</span>
<span id="cb9-145"><a href="#cb9-145" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (metric <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"ex_ante"</span>, <span class="st">"ex_post_type"</span>, <span class="st">"ex_post_payoff"</span>)) {</span>
<span id="cb9-146"><a href="#cb9-146" aria-hidden="true" tabindex="-1"></a>      ai_metrics[[ai_type]][[metric]] <span class="ot">&lt;-</span> ai_metrics[[ai_type]][[metric]] <span class="sc">/</span> config<span class="sc">$</span>num_trials</span>
<span id="cb9-147"><a href="#cb9-147" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-148"><a href="#cb9-148" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-149"><a href="#cb9-149" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-150"><a href="#cb9-150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">ai_metrics =</span> ai_metrics, <span class="at">detailed_data =</span> detailed_data))</span>
<span id="cb9-151"><a href="#cb9-151" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-152"><a href="#cb9-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-153"><a href="#cb9-153" aria-hidden="true" tabindex="-1"></a>run_all_simulations <span class="ot">&lt;-</span> <span class="cf">function</span>(config, <span class="at">num_simulations_to_run =</span> <span class="cn">NULL</span>) {</span>
<span id="cb9-154"><a href="#cb9-154" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Run simulations for all prior probabilities</span></span>
<span id="cb9-155"><a href="#cb9-155" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb9-156"><a href="#cb9-156" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Args:</span></span>
<span id="cb9-157"><a href="#cb9-157" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   config: Simulation configuration parameters</span></span>
<span id="cb9-158"><a href="#cb9-158" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   num_simulations_to_run: Optional override for number of simulations</span></span>
<span id="cb9-159"><a href="#cb9-159" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb9-160"><a href="#cb9-160" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Returns:</span></span>
<span id="cb9-161"><a href="#cb9-161" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   List containing:</span></span>
<span id="cb9-162"><a href="#cb9-162" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   - standard_results: Standard results dictionary</span></span>
<span id="cb9-163"><a href="#cb9-163" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   - forced_results: Forced choice results dictionary</span></span>
<span id="cb9-164"><a href="#cb9-164" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   - trial_df: DataFrame with detailed trial data</span></span>
<span id="cb9-165"><a href="#cb9-165" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-166"><a href="#cb9-166" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(num_simulations_to_run)) {</span>
<span id="cb9-167"><a href="#cb9-167" aria-hidden="true" tabindex="-1"></a>    num_simulations_to_run <span class="ot">&lt;-</span> config<span class="sc">$</span>num_simulations</span>
<span id="cb9-168"><a href="#cb9-168" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-169"><a href="#cb9-169" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-170"><a href="#cb9-170" aria-hidden="true" tabindex="-1"></a>  standard_results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb9-171"><a href="#cb9-171" aria-hidden="true" tabindex="-1"></a>  forced_results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb9-172"><a href="#cb9-172" aria-hidden="true" tabindex="-1"></a>  all_detailed_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb9-173"><a href="#cb9-173" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-174"><a href="#cb9-174" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (p_idx <span class="cf">in</span> <span class="fu">seq_along</span>(config<span class="sc">$</span>p)) {</span>
<span id="cb9-175"><a href="#cb9-175" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> config<span class="sc">$</span>p[p_idx]</span>
<span id="cb9-176"><a href="#cb9-176" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Processing prior %d of %d: p = %f</span><span class="sc">\n</span><span class="st">"</span>, p_idx, <span class="fu">length</span>(config<span class="sc">$</span>p), p))</span>
<span id="cb9-177"><a href="#cb9-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-178"><a href="#cb9-178" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Vectorized outcome generation</span></span>
<span id="cb9-179"><a href="#cb9-179" aria-hidden="true" tabindex="-1"></a>    num_sims <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">is.null</span>(num_simulations_to_run)) config<span class="sc">$</span>num_simulations <span class="cf">else</span> num_simulations_to_run</span>
<span id="cb9-180"><a href="#cb9-180" aria-hidden="true" tabindex="-1"></a>    share_flags <span class="ot">&lt;-</span> <span class="fu">runif</span>(num_sims) <span class="sc">&lt;</span> p</span>
<span id="cb9-181"><a href="#cb9-181" aria-hidden="true" tabindex="-1"></a>    raw_outcomes <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb9-182"><a href="#cb9-182" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rbinom</span>(num_sims <span class="sc">*</span> config<span class="sc">$</span>num_trials, <span class="dv">1</span>, config<span class="sc">$</span>q),</span>
<span id="cb9-183"><a href="#cb9-183" aria-hidden="true" tabindex="-1"></a>      <span class="at">ncol =</span> config<span class="sc">$</span>num_trials,</span>
<span id="cb9-184"><a href="#cb9-184" aria-hidden="true" tabindex="-1"></a>      <span class="at">byrow =</span> <span class="cn">TRUE</span></span>
<span id="cb9-185"><a href="#cb9-185" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-186"><a href="#cb9-186" aria-hidden="true" tabindex="-1"></a>    <span class="co"># outcomes_mat: 1 = "high" for shares; invert rows for bad shares</span></span>
<span id="cb9-187"><a href="#cb9-187" aria-hidden="true" tabindex="-1"></a>    outcomes_mat <span class="ot">&lt;-</span> raw_outcomes</span>
<span id="cb9-188"><a href="#cb9-188" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">any</span>(<span class="sc">!</span>share_flags)) {</span>
<span id="cb9-189"><a href="#cb9-189" aria-hidden="true" tabindex="-1"></a>      outcomes_mat[<span class="sc">!</span>share_flags, ] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> outcomes_mat[<span class="sc">!</span>share_flags, ]</span>
<span id="cb9-190"><a href="#cb9-190" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-191"><a href="#cb9-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-192"><a href="#cb9-192" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize accumulators for this prior</span></span>
<span id="cb9-193"><a href="#cb9-193" aria-hidden="true" tabindex="-1"></a>    sums <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb9-194"><a href="#cb9-194" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (ai_type <span class="cf">in</span> config<span class="sc">$</span>ai_types) {</span>
<span id="cb9-195"><a href="#cb9-195" aria-hidden="true" tabindex="-1"></a>      sums[[ai_type]] <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb9-196"><a href="#cb9-196" aria-hidden="true" tabindex="-1"></a>        <span class="at">ex_ante =</span> <span class="fl">0.0</span>,</span>
<span id="cb9-197"><a href="#cb9-197" aria-hidden="true" tabindex="-1"></a>        <span class="at">ex_post_type =</span> <span class="fl">0.0</span>,</span>
<span id="cb9-198"><a href="#cb9-198" aria-hidden="true" tabindex="-1"></a>        <span class="at">ex_post_payoff =</span> <span class="fl">0.0</span>,</span>
<span id="cb9-199"><a href="#cb9-199" aria-hidden="true" tabindex="-1"></a>        <span class="at">forced_correct =</span> <span class="fl">0.0</span>,</span>
<span id="cb9-200"><a href="#cb9-200" aria-hidden="true" tabindex="-1"></a>        <span class="at">forced_type_correct =</span> <span class="fl">0.0</span>,</span>
<span id="cb9-201"><a href="#cb9-201" aria-hidden="true" tabindex="-1"></a>        <span class="at">forced_payoff_correct =</span> <span class="fl">0.0</span>,</span>
<span id="cb9-202"><a href="#cb9-202" aria-hidden="true" tabindex="-1"></a>        <span class="at">forced_total =</span> <span class="fl">0.0</span></span>
<span id="cb9-203"><a href="#cb9-203" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb9-204"><a href="#cb9-204" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-205"><a href="#cb9-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-206"><a href="#cb9-206" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Run simulations for this prior probability</span></span>
<span id="cb9-207"><a href="#cb9-207" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (sim_id <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_sims) {</span>
<span id="cb9-208"><a href="#cb9-208" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (sim_id <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb9-209"><a href="#cb9-209" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"  Simulation %d of %d (%.1f%%)</span><span class="sc">\n</span><span class="st">"</span>, </span>
<span id="cb9-210"><a href="#cb9-210" aria-hidden="true" tabindex="-1"></a>                   sim_id, num_sims, sim_id<span class="sc">/</span>num_sims<span class="sc">*</span><span class="dv">100</span>))</span>
<span id="cb9-211"><a href="#cb9-211" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb9-212"><a href="#cb9-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-213"><a href="#cb9-213" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Use precomputed vectors</span></span>
<span id="cb9-214"><a href="#cb9-214" aria-hidden="true" tabindex="-1"></a>      share_type <span class="ot">&lt;-</span> <span class="cf">if</span> (share_flags[sim_id]) <span class="st">"good"</span> <span class="cf">else</span> <span class="st">"bad"</span></span>
<span id="cb9-215"><a href="#cb9-215" aria-hidden="true" tabindex="-1"></a>      outcomes <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(outcomes_mat[sim_id,] <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"high"</span>, <span class="st">"low"</span>)</span>
<span id="cb9-216"><a href="#cb9-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-217"><a href="#cb9-217" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Get the correct decision based on the true share type</span></span>
<span id="cb9-218"><a href="#cb9-218" aria-hidden="true" tabindex="-1"></a>      correct_decision <span class="ot">&lt;-</span> <span class="fu">get_correct_decision</span>(share_type, config)</span>
<span id="cb9-219"><a href="#cb9-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-220"><a href="#cb9-220" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Track recommendations and metrics for each AI type</span></span>
<span id="cb9-221"><a href="#cb9-221" aria-hidden="true" tabindex="-1"></a>      ai_metrics <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb9-222"><a href="#cb9-222" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (ai_type <span class="cf">in</span> config<span class="sc">$</span>ai_types) {</span>
<span id="cb9-223"><a href="#cb9-223" aria-hidden="true" tabindex="-1"></a>        ai_metrics[[ai_type]] <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb9-224"><a href="#cb9-224" aria-hidden="true" tabindex="-1"></a>          <span class="at">ex_ante =</span> <span class="dv">0</span>,</span>
<span id="cb9-225"><a href="#cb9-225" aria-hidden="true" tabindex="-1"></a>          <span class="at">ex_post_type =</span> <span class="dv">0</span>,</span>
<span id="cb9-226"><a href="#cb9-226" aria-hidden="true" tabindex="-1"></a>          <span class="at">ex_post_payoff =</span> <span class="dv">0</span>,</span>
<span id="cb9-227"><a href="#cb9-227" aria-hidden="true" tabindex="-1"></a>          <span class="at">forced_correct =</span> <span class="dv">0</span>,</span>
<span id="cb9-228"><a href="#cb9-228" aria-hidden="true" tabindex="-1"></a>          <span class="at">forced_type_correct =</span> <span class="dv">0</span>,</span>
<span id="cb9-229"><a href="#cb9-229" aria-hidden="true" tabindex="-1"></a>          <span class="at">forced_payoff_correct =</span> <span class="dv">0</span>,</span>
<span id="cb9-230"><a href="#cb9-230" aria-hidden="true" tabindex="-1"></a>          <span class="at">forced_total =</span> <span class="dv">0</span></span>
<span id="cb9-231"><a href="#cb9-231" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb9-232"><a href="#cb9-232" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb9-233"><a href="#cb9-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-234"><a href="#cb9-234" aria-hidden="true" tabindex="-1"></a>      total_rows <span class="ot">&lt;-</span> config<span class="sc">$</span>num_trials <span class="sc">*</span> <span class="fu">length</span>(config<span class="sc">$</span>ai_types)</span>
<span id="cb9-235"><a href="#cb9-235" aria-hidden="true" tabindex="-1"></a>      detailed_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb9-236"><a href="#cb9-236" aria-hidden="true" tabindex="-1"></a>        <span class="at">sim_id =</span> <span class="fu">numeric</span>(total_rows),</span>
<span id="cb9-237"><a href="#cb9-237" aria-hidden="true" tabindex="-1"></a>        <span class="at">prior =</span> <span class="fu">numeric</span>(total_rows),</span>
<span id="cb9-238"><a href="#cb9-238" aria-hidden="true" tabindex="-1"></a>        <span class="at">trial =</span> <span class="fu">numeric</span>(total_rows),</span>
<span id="cb9-239"><a href="#cb9-239" aria-hidden="true" tabindex="-1"></a>        <span class="at">ai_type =</span> <span class="fu">character</span>(total_rows),</span>
<span id="cb9-240"><a href="#cb9-240" aria-hidden="true" tabindex="-1"></a>        <span class="at">true_share_type =</span> <span class="fu">character</span>(total_rows),</span>
<span id="cb9-241"><a href="#cb9-241" aria-hidden="true" tabindex="-1"></a>        <span class="at">outcome =</span> <span class="fu">character</span>(total_rows),</span>
<span id="cb9-242"><a href="#cb9-242" aria-hidden="true" tabindex="-1"></a>        <span class="at">ai_rec =</span> <span class="fu">character</span>(total_rows),</span>
<span id="cb9-243"><a href="#cb9-243" aria-hidden="true" tabindex="-1"></a>        <span class="at">ev_optimal =</span> <span class="fu">character</span>(total_rows),</span>
<span id="cb9-244"><a href="#cb9-244" aria-hidden="true" tabindex="-1"></a>        <span class="at">ev_accuracy =</span> <span class="fu">numeric</span>(total_rows),</span>
<span id="cb9-245"><a href="#cb9-245" aria-hidden="true" tabindex="-1"></a>        <span class="at">rec_accuracy =</span> <span class="fu">numeric</span>(total_rows),</span>
<span id="cb9-246"><a href="#cb9-246" aria-hidden="true" tabindex="-1"></a>        <span class="at">outcome_accuracy =</span> <span class="fu">numeric</span>(total_rows),</span>
<span id="cb9-247"><a href="#cb9-247" aria-hidden="true" tabindex="-1"></a>        <span class="at">forced_accuracy =</span> <span class="fu">numeric</span>(total_rows),</span>
<span id="cb9-248"><a href="#cb9-248" aria-hidden="true" tabindex="-1"></a>        <span class="at">is_ev_tie =</span> <span class="fu">logical</span>(total_rows),</span>
<span id="cb9-249"><a href="#cb9-249" aria-hidden="true" tabindex="-1"></a>        <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb9-250"><a href="#cb9-250" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb9-251"><a href="#cb9-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-252"><a href="#cb9-252" aria-hidden="true" tabindex="-1"></a>      row_index <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb9-253"><a href="#cb9-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-254"><a href="#cb9-254" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Simulate AI recommendations at each trial</span></span>
<span id="cb9-255"><a href="#cb9-255" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (trial <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>config<span class="sc">$</span>num_trials) {</span>
<span id="cb9-256"><a href="#cb9-256" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get outcomes observed so far (excluding current trial)</span></span>
<span id="cb9-257"><a href="#cb9-257" aria-hidden="true" tabindex="-1"></a>        observed_outcomes <span class="ot">&lt;-</span> <span class="cf">if</span>(trial <span class="sc">&gt;</span> <span class="dv">1</span>) outcomes[<span class="dv">1</span><span class="sc">:</span>(trial<span class="dv">-1</span>)] <span class="cf">else</span> <span class="fu">character</span>(<span class="dv">0</span>)</span>
<span id="cb9-258"><a href="#cb9-258" aria-hidden="true" tabindex="-1"></a>        current_outcome <span class="ot">&lt;-</span> outcomes[trial]</span>
<span id="cb9-259"><a href="#cb9-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-260"><a href="#cb9-260" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get true Bayesian posterior for EV measure</span></span>
<span id="cb9-261"><a href="#cb9-261" aria-hidden="true" tabindex="-1"></a>        true_posterior <span class="ot">&lt;-</span> <span class="fu">calculate_posterior</span>(<span class="st">"perfect"</span>, p, observed_outcomes, trial<span class="dv">-1</span>, config)</span>
<span id="cb9-262"><a href="#cb9-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-263"><a href="#cb9-263" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate expected return based on true posterior</span></span>
<span id="cb9-264"><a href="#cb9-264" aria-hidden="true" tabindex="-1"></a>        expected_return <span class="ot">&lt;-</span> <span class="fu">calculate_expected_return</span>(true_posterior, config)</span>
<span id="cb9-265"><a href="#cb9-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-266"><a href="#cb9-266" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Determine optimal decision based on expected return</span></span>
<span id="cb9-267"><a href="#cb9-267" aria-hidden="true" tabindex="-1"></a>        ev_optimal_decision <span class="ot">&lt;-</span> <span class="cf">if</span>(expected_return <span class="sc">&gt;</span> config<span class="sc">$</span>bond_payoff) {</span>
<span id="cb9-268"><a href="#cb9-268" aria-hidden="true" tabindex="-1"></a>          <span class="st">"share"</span></span>
<span id="cb9-269"><a href="#cb9-269" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> <span class="cf">if</span>(expected_return <span class="sc">&lt;</span> config<span class="sc">$</span>bond_payoff) {</span>
<span id="cb9-270"><a href="#cb9-270" aria-hidden="true" tabindex="-1"></a>          <span class="st">"bond"</span></span>
<span id="cb9-271"><a href="#cb9-271" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb9-272"><a href="#cb9-272" aria-hidden="true" tabindex="-1"></a>          <span class="st">"indifferent"</span></span>
<span id="cb9-273"><a href="#cb9-273" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb9-274"><a href="#cb9-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-275"><a href="#cb9-275" aria-hidden="true" tabindex="-1"></a>        <span class="co"># For each AI type, get recommendation and measure correctness</span></span>
<span id="cb9-276"><a href="#cb9-276" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (ai_type <span class="cf">in</span> config<span class="sc">$</span>ai_types) {</span>
<span id="cb9-277"><a href="#cb9-277" aria-hidden="true" tabindex="-1"></a>          ai_rec <span class="ot">&lt;-</span> <span class="fu">get_ai_recommendation</span>(ai_type, p, observed_outcomes, trial<span class="dv">-1</span>, config)</span>
<span id="cb9-278"><a href="#cb9-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-279"><a href="#cb9-279" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Ex-Ante correctness (match with statistical optimality)</span></span>
<span id="cb9-280"><a href="#cb9-280" aria-hidden="true" tabindex="-1"></a>          ex_ante_correct <span class="ot">&lt;-</span> <span class="fu">measure_ex_ante_correctness</span>(ai_rec, true_posterior, config)</span>
<span id="cb9-281"><a href="#cb9-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-282"><a href="#cb9-282" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Ex-Post Type correctness (match with true share type)</span></span>
<span id="cb9-283"><a href="#cb9-283" aria-hidden="true" tabindex="-1"></a>          ex_post_type_correct <span class="ot">&lt;-</span> <span class="fu">measure_ex_post_share_type</span>(ai_rec, share_type)</span>
<span id="cb9-284"><a href="#cb9-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-285"><a href="#cb9-285" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Ex-Post Payoff correctness (match with actual outcome)</span></span>
<span id="cb9-286"><a href="#cb9-286" aria-hidden="true" tabindex="-1"></a>          ex_post_payoff_correct <span class="ot">&lt;-</span> <span class="fu">measure_ex_post_payoff</span>(ai_rec, current_outcome)</span>
<span id="cb9-287"><a href="#cb9-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-288"><a href="#cb9-288" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Forced choice Ex-Ante correctness (excluding ties)</span></span>
<span id="cb9-289"><a href="#cb9-289" aria-hidden="true" tabindex="-1"></a>          is_ev_tie <span class="ot">&lt;-</span> <span class="fu">abs</span>(expected_return <span class="sc">-</span> config<span class="sc">$</span>bond_payoff) <span class="sc">&lt;</span> <span class="fl">1e-10</span></span>
<span id="cb9-290"><a href="#cb9-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-291"><a href="#cb9-291" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (is_ev_tie) {</span>
<span id="cb9-292"><a href="#cb9-292" aria-hidden="true" tabindex="-1"></a>            forced_correct <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb9-293"><a href="#cb9-293" aria-hidden="true" tabindex="-1"></a>            should_include <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb9-294"><a href="#cb9-294" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb9-295"><a href="#cb9-295" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Standard scoring</span></span>
<span id="cb9-296"><a href="#cb9-296" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (expected_return <span class="sc">&gt;</span> config<span class="sc">$</span>bond_payoff) {</span>
<span id="cb9-297"><a href="#cb9-297" aria-hidden="true" tabindex="-1"></a>              forced_correct <span class="ot">&lt;-</span> <span class="cf">if</span>(ai_rec <span class="sc">==</span> <span class="st">"share"</span>) <span class="fl">1.0</span> <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb9-298"><a href="#cb9-298" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span> { <span class="co"># expected_return &lt; config$bond_payoff</span></span>
<span id="cb9-299"><a href="#cb9-299" aria-hidden="true" tabindex="-1"></a>              forced_correct <span class="ot">&lt;-</span> <span class="cf">if</span>(ai_rec <span class="sc">==</span> <span class="st">"bond"</span>) <span class="fl">1.0</span> <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb9-300"><a href="#cb9-300" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb9-301"><a href="#cb9-301" aria-hidden="true" tabindex="-1"></a>            should_include <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb9-302"><a href="#cb9-302" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb9-303"><a href="#cb9-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-304"><a href="#cb9-304" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Add to metrics</span></span>
<span id="cb9-305"><a href="#cb9-305" aria-hidden="true" tabindex="-1"></a>          ai_metrics[[ai_type]]<span class="sc">$</span>ex_ante <span class="ot">&lt;-</span> ai_metrics[[ai_type]]<span class="sc">$</span>ex_ante <span class="sc">+</span> ex_ante_correct</span>
<span id="cb9-306"><a href="#cb9-306" aria-hidden="true" tabindex="-1"></a>          ai_metrics[[ai_type]]<span class="sc">$</span>ex_post_type <span class="ot">&lt;-</span> ai_metrics[[ai_type]]<span class="sc">$</span>ex_post_type <span class="sc">+</span> ex_post_type_correct</span>
<span id="cb9-307"><a href="#cb9-307" aria-hidden="true" tabindex="-1"></a>          ai_metrics[[ai_type]]<span class="sc">$</span>ex_post_payoff <span class="ot">&lt;-</span> ai_metrics[[ai_type]]<span class="sc">$</span>ex_post_payoff <span class="sc">+</span> ex_post_payoff_correct</span>
<span id="cb9-308"><a href="#cb9-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-309"><a href="#cb9-309" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Only include in forced choice metric if it's not a tie</span></span>
<span id="cb9-310"><a href="#cb9-310" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (should_include) {</span>
<span id="cb9-311"><a href="#cb9-311" aria-hidden="true" tabindex="-1"></a>            ai_metrics[[ai_type]]<span class="sc">$</span>forced_correct <span class="ot">&lt;-</span> ai_metrics[[ai_type]]<span class="sc">$</span>forced_correct <span class="sc">+</span> forced_correct</span>
<span id="cb9-312"><a href="#cb9-312" aria-hidden="true" tabindex="-1"></a>            ai_metrics[[ai_type]]<span class="sc">$</span>forced_type_correct <span class="ot">&lt;-</span> ai_metrics[[ai_type]]<span class="sc">$</span>forced_type_correct <span class="sc">+</span> ex_post_type_correct</span>
<span id="cb9-313"><a href="#cb9-313" aria-hidden="true" tabindex="-1"></a>            ai_metrics[[ai_type]]<span class="sc">$</span>forced_payoff_correct <span class="ot">&lt;-</span> ai_metrics[[ai_type]]<span class="sc">$</span>forced_payoff_correct <span class="sc">+</span> ex_post_payoff_correct</span>
<span id="cb9-314"><a href="#cb9-314" aria-hidden="true" tabindex="-1"></a>            ai_metrics[[ai_type]]<span class="sc">$</span>forced_total <span class="ot">&lt;-</span> ai_metrics[[ai_type]]<span class="sc">$</span>forced_total <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb9-315"><a href="#cb9-315" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb9-316"><a href="#cb9-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-317"><a href="#cb9-317" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Record detailed data for this trial</span></span>
<span id="cb9-318"><a href="#cb9-318" aria-hidden="true" tabindex="-1"></a>          detailed_data[row_index, ] <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb9-319"><a href="#cb9-319" aria-hidden="true" tabindex="-1"></a>            <span class="at">sim_id =</span> sim_id,</span>
<span id="cb9-320"><a href="#cb9-320" aria-hidden="true" tabindex="-1"></a>            <span class="at">prior =</span> p,</span>
<span id="cb9-321"><a href="#cb9-321" aria-hidden="true" tabindex="-1"></a>            <span class="at">trial =</span> trial,</span>
<span id="cb9-322"><a href="#cb9-322" aria-hidden="true" tabindex="-1"></a>            <span class="at">ai_type =</span> ai_type,</span>
<span id="cb9-323"><a href="#cb9-323" aria-hidden="true" tabindex="-1"></a>            <span class="at">true_share_type =</span> share_type,</span>
<span id="cb9-324"><a href="#cb9-324" aria-hidden="true" tabindex="-1"></a>            <span class="at">outcome =</span> current_outcome,</span>
<span id="cb9-325"><a href="#cb9-325" aria-hidden="true" tabindex="-1"></a>            <span class="at">ai_rec =</span> ai_rec,</span>
<span id="cb9-326"><a href="#cb9-326" aria-hidden="true" tabindex="-1"></a>            <span class="at">ev_optimal =</span> ev_optimal_decision,</span>
<span id="cb9-327"><a href="#cb9-327" aria-hidden="true" tabindex="-1"></a>            <span class="at">ev_accuracy =</span> ex_ante_correct,</span>
<span id="cb9-328"><a href="#cb9-328" aria-hidden="true" tabindex="-1"></a>            <span class="at">rec_accuracy =</span> ex_post_type_correct,</span>
<span id="cb9-329"><a href="#cb9-329" aria-hidden="true" tabindex="-1"></a>            <span class="at">outcome_accuracy =</span> ex_post_payoff_correct,</span>
<span id="cb9-330"><a href="#cb9-330" aria-hidden="true" tabindex="-1"></a>            <span class="at">forced_accuracy =</span> <span class="cf">if</span>(should_include) forced_correct <span class="cf">else</span> <span class="cn">NA</span>,</span>
<span id="cb9-331"><a href="#cb9-331" aria-hidden="true" tabindex="-1"></a>            <span class="at">is_ev_tie =</span> <span class="sc">!</span>should_include</span>
<span id="cb9-332"><a href="#cb9-332" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb9-333"><a href="#cb9-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-334"><a href="#cb9-334" aria-hidden="true" tabindex="-1"></a>          row_index <span class="ot">&lt;-</span> row_index <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb9-335"><a href="#cb9-335" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb9-336"><a href="#cb9-336" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb9-337"><a href="#cb9-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-338"><a href="#cb9-338" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Convert trial sums to averages</span></span>
<span id="cb9-339"><a href="#cb9-339" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (ai_type <span class="cf">in</span> config<span class="sc">$</span>ai_types) {</span>
<span id="cb9-340"><a href="#cb9-340" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (metric <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"ex_ante"</span>, <span class="st">"ex_post_type"</span>, <span class="st">"ex_post_payoff"</span>)) {</span>
<span id="cb9-341"><a href="#cb9-341" aria-hidden="true" tabindex="-1"></a>          ai_metrics[[ai_type]][[metric]] <span class="ot">&lt;-</span> ai_metrics[[ai_type]][[metric]] <span class="sc">/</span> config<span class="sc">$</span>num_trials</span>
<span id="cb9-342"><a href="#cb9-342" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb9-343"><a href="#cb9-343" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb9-344"><a href="#cb9-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-345"><a href="#cb9-345" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Collect detailed data</span></span>
<span id="cb9-346"><a href="#cb9-346" aria-hidden="true" tabindex="-1"></a>      all_detailed_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(all_detailed_data, detailed_data)</span>
<span id="cb9-347"><a href="#cb9-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-348"><a href="#cb9-348" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Aggregate results</span></span>
<span id="cb9-349"><a href="#cb9-349" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (ai_type <span class="cf">in</span> config<span class="sc">$</span>ai_types) {</span>
<span id="cb9-350"><a href="#cb9-350" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (metric <span class="cf">in</span> <span class="fu">names</span>(sums[[ai_type]])) {</span>
<span id="cb9-351"><a href="#cb9-351" aria-hidden="true" tabindex="-1"></a>          sums[[ai_type]][[metric]] <span class="ot">&lt;-</span> sums[[ai_type]][[metric]] <span class="sc">+</span> ai_metrics[[ai_type]][[metric]]</span>
<span id="cb9-352"><a href="#cb9-352" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb9-353"><a href="#cb9-353" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb9-354"><a href="#cb9-354" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-355"><a href="#cb9-355" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-356"><a href="#cb9-356" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Process standard results</span></span>
<span id="cb9-357"><a href="#cb9-357" aria-hidden="true" tabindex="-1"></a>    standard_results[[<span class="fu">as.character</span>(p)]] <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb9-358"><a href="#cb9-358" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (ai_type <span class="cf">in</span> config<span class="sc">$</span>ai_types) {</span>
<span id="cb9-359"><a href="#cb9-359" aria-hidden="true" tabindex="-1"></a>      standard_results[[<span class="fu">as.character</span>(p)]][[ai_type]] <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb9-360"><a href="#cb9-360" aria-hidden="true" tabindex="-1"></a>        <span class="at">ex_ante =</span> sums[[ai_type]]<span class="sc">$</span>ex_ante <span class="sc">/</span> num_simulations_to_run,</span>
<span id="cb9-361"><a href="#cb9-361" aria-hidden="true" tabindex="-1"></a>        <span class="at">ex_post_type =</span> sums[[ai_type]]<span class="sc">$</span>ex_post_type <span class="sc">/</span> num_simulations_to_run, </span>
<span id="cb9-362"><a href="#cb9-362" aria-hidden="true" tabindex="-1"></a>        <span class="at">ex_post_payoff =</span> sums[[ai_type]]<span class="sc">$</span>ex_post_payoff <span class="sc">/</span> num_simulations_to_run</span>
<span id="cb9-363"><a href="#cb9-363" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb9-364"><a href="#cb9-364" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-365"><a href="#cb9-365" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-366"><a href="#cb9-366" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Process forced choice results separately</span></span>
<span id="cb9-367"><a href="#cb9-367" aria-hidden="true" tabindex="-1"></a>    forced_results[[<span class="fu">as.character</span>(p)]] <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb9-368"><a href="#cb9-368" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (ai_type <span class="cf">in</span> config<span class="sc">$</span>ai_types) {</span>
<span id="cb9-369"><a href="#cb9-369" aria-hidden="true" tabindex="-1"></a>      total_forced <span class="ot">&lt;-</span> sums[[ai_type]]<span class="sc">$</span>forced_total</span>
<span id="cb9-370"><a href="#cb9-370" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (total_forced <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb9-371"><a href="#cb9-371" aria-hidden="true" tabindex="-1"></a>        ex_ante_accuracy <span class="ot">&lt;-</span> sums[[ai_type]]<span class="sc">$</span>forced_correct <span class="sc">/</span> total_forced</span>
<span id="cb9-372"><a href="#cb9-372" aria-hidden="true" tabindex="-1"></a>        ex_post_type_accuracy <span class="ot">&lt;-</span> sums[[ai_type]]<span class="sc">$</span>forced_type_correct <span class="sc">/</span> total_forced</span>
<span id="cb9-373"><a href="#cb9-373" aria-hidden="true" tabindex="-1"></a>        ex_post_payoff_accuracy <span class="ot">&lt;-</span> sums[[ai_type]]<span class="sc">$</span>forced_payoff_correct <span class="sc">/</span> total_forced</span>
<span id="cb9-374"><a href="#cb9-374" aria-hidden="true" tabindex="-1"></a>        pct_included <span class="ot">&lt;-</span> total_forced <span class="sc">/</span> (num_simulations_to_run <span class="sc">*</span> config<span class="sc">$</span>num_trials) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb9-375"><a href="#cb9-375" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb9-376"><a href="#cb9-376" aria-hidden="true" tabindex="-1"></a>        ex_ante_accuracy <span class="ot">&lt;-</span> <span class="cn">NaN</span></span>
<span id="cb9-377"><a href="#cb9-377" aria-hidden="true" tabindex="-1"></a>        ex_post_type_accuracy <span class="ot">&lt;-</span> <span class="cn">NaN</span></span>
<span id="cb9-378"><a href="#cb9-378" aria-hidden="true" tabindex="-1"></a>        ex_post_payoff_accuracy <span class="ot">&lt;-</span> <span class="cn">NaN</span></span>
<span id="cb9-379"><a href="#cb9-379" aria-hidden="true" tabindex="-1"></a>        pct_included <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb9-380"><a href="#cb9-380" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb9-381"><a href="#cb9-381" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb9-382"><a href="#cb9-382" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Format exactly like standard_results to work with existing plot function</span></span>
<span id="cb9-383"><a href="#cb9-383" aria-hidden="true" tabindex="-1"></a>      forced_results[[<span class="fu">as.character</span>(p)]][[ai_type]] <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb9-384"><a href="#cb9-384" aria-hidden="true" tabindex="-1"></a>        <span class="at">ex_ante =</span> ex_ante_accuracy,</span>
<span id="cb9-385"><a href="#cb9-385" aria-hidden="true" tabindex="-1"></a>        <span class="at">ex_post_type =</span> ex_post_type_accuracy,</span>
<span id="cb9-386"><a href="#cb9-386" aria-hidden="true" tabindex="-1"></a>        <span class="at">ex_post_payoff =</span> ex_post_payoff_accuracy,</span>
<span id="cb9-387"><a href="#cb9-387" aria-hidden="true" tabindex="-1"></a>        <span class="at">pct_included =</span> pct_included</span>
<span id="cb9-388"><a href="#cb9-388" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb9-389"><a href="#cb9-389" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-390"><a href="#cb9-390" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-391"><a href="#cb9-391" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-392"><a href="#cb9-392" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb9-393"><a href="#cb9-393" aria-hidden="true" tabindex="-1"></a>    <span class="at">standard =</span> standard_results,</span>
<span id="cb9-394"><a href="#cb9-394" aria-hidden="true" tabindex="-1"></a>    <span class="at">forced =</span> forced_results,</span>
<span id="cb9-395"><a href="#cb9-395" aria-hidden="true" tabindex="-1"></a>    <span class="at">trial_df =</span> all_detailed_data</span>
<span id="cb9-396"><a href="#cb9-396" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb9-397"><a href="#cb9-397" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="analytical-solution" class="level2">
<h2 class="anchored" data-anchor-id="analytical-solution">Analytical solution</h2>
<p>This section provides the functions for the analytical solution. It comprises the following functions:</p>
<ul>
<li><code>seq_probability</code>: Calculates the probability of a specific sequence of outcomes given the share type (good or bad) and the prior probability.</li>
<li><code>run_all_measures</code>: Runs the analytical solution for all measures (ex-ante, ex-post type, and ex-post payoff) across all prior probabilities and outcomes.</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="do">##########################</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Probability of a sequence</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="do">##########################</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>seq_probability <span class="ot">&lt;-</span> <span class="cf">function</span>(sequence, share_type, config) {</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Probability of seeing 'sequence' if the share is good or bad.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Args:</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   sequence: Vector of 'high' or 'low' outcomes</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   share_type: 'good' or 'bad'</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   config: Simulation configuration parameters</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Returns:</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   Probability of the sequence occurring</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert sequence to binary vector (1 for high, 0 for low)</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.numeric</span>(sequence)) {</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If already numeric, use it directly</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    seq_arr <span class="ot">&lt;-</span> sequence</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert vector of strings to binary vector</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    seq_arr <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(sequence <span class="sc">==</span> <span class="st">"high"</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Count high outcomes</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  nH <span class="ot">&lt;-</span> <span class="fu">sum</span>(seq_arr)</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Count low outcomes</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>  nL <span class="ot">&lt;-</span> <span class="fu">length</span>(seq_arr) <span class="sc">-</span> nH</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (share_type <span class="sc">==</span> <span class="st">"good"</span>) {</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>((config<span class="sc">$</span>q <span class="sc">^</span> nH) <span class="sc">*</span> ((<span class="fl">1.0</span> <span class="sc">-</span> config<span class="sc">$</span>q) <span class="sc">^</span> nL))</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(((<span class="fl">1.0</span> <span class="sc">-</span> config<span class="sc">$</span>q) <span class="sc">^</span> nH) <span class="sc">*</span> (config<span class="sc">$</span>q <span class="sc">^</span> nL))</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a><span class="do">##########################</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Main enumeration function</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a><span class="do">##########################</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>run_all_measures <span class="ot">&lt;-</span> <span class="cf">function</span>(config) {</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Enumerates all 2^num_trials sequences, simulates each AI's picks,</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># and calculates three measures of accuracy.</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Args:</span></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   config: Simulation configuration parameters</span></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Returns:</span></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   List with:</span></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   - standard_results: Standard results list</span></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   - forced_results: Forced choice results list</span></span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate all possible binary sequences</span></span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>  binary_sequences <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="fu">replicate</span>(config<span class="sc">$</span>num_trials, <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">simplify =</span> <span class="cn">FALSE</span>))</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert to matrix for easier processing</span></span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>  sequences <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(binary_sequences)</span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Results lists</span></span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>  standard_results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>  forced_results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># For each prior probability</span></span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (p <span class="cf">in</span> config<span class="sc">$</span>p) {</span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Calculating analytical solution for p=%s</span><span class="sc">\n</span><span class="st">"</span>, p))</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Pre-calculate sequence high/low counts all at once</span></span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>    high_counts <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(sequences)</span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>    low_counts <span class="ot">&lt;-</span> config<span class="sc">$</span>num_trials <span class="sc">-</span> high_counts</span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate all probabilities at once</span></span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a>    probs_good <span class="ot">&lt;-</span> (config<span class="sc">$</span>q <span class="sc">^</span> high_counts) <span class="sc">*</span> ((<span class="dv">1</span><span class="sc">-</span>config<span class="sc">$</span>q) <span class="sc">^</span> low_counts)</span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a>    probs_bad <span class="ot">&lt;-</span> ((<span class="dv">1</span><span class="sc">-</span>config<span class="sc">$</span>q) <span class="sc">^</span> high_counts) <span class="sc">*</span> (config<span class="sc">$</span>q <span class="sc">^</span> low_counts)</span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert sequences to string representations (vectorized)</span></span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a>    seq_strings <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(sequences), <span class="cf">function</span>(i) {</span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ifelse</span>(sequences[i,] <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"high"</span>, <span class="st">"low"</span>)</span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize measures for each AI type (standard measures)</span></span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a>    measure_sums <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (ai_type <span class="cf">in</span> config<span class="sc">$</span>ai_types) {</span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a>      measure_sums[[ai_type]] <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a>        <span class="at">ex_ante =</span> <span class="fl">0.0</span>,</span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a>        <span class="at">ex_post_type =</span> <span class="fl">0.0</span>,</span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a>        <span class="at">ex_post_payoff =</span> <span class="fl">0.0</span></span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize forced choice measures</span></span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true" tabindex="-1"></a>    forced_sums <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (ai_type <span class="cf">in</span> config<span class="sc">$</span>ai_types) {</span>
<span id="cb10-93"><a href="#cb10-93" aria-hidden="true" tabindex="-1"></a>      forced_sums[[ai_type]] <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb10-94"><a href="#cb10-94" aria-hidden="true" tabindex="-1"></a>        <span class="at">ex_ante =</span> <span class="fl">0.0</span>,</span>
<span id="cb10-95"><a href="#cb10-95" aria-hidden="true" tabindex="-1"></a>        <span class="at">ex_post_type =</span> <span class="fl">0.0</span>,</span>
<span id="cb10-96"><a href="#cb10-96" aria-hidden="true" tabindex="-1"></a>        <span class="at">ex_post_payoff =</span> <span class="fl">0.0</span>,</span>
<span id="cb10-97"><a href="#cb10-97" aria-hidden="true" tabindex="-1"></a>        <span class="at">total_cases =</span> <span class="fl">0.0</span>,</span>
<span id="cb10-98"><a href="#cb10-98" aria-hidden="true" tabindex="-1"></a>        <span class="at">total_weight =</span> <span class="fl">0.0</span></span>
<span id="cb10-99"><a href="#cb10-99" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb10-100"><a href="#cb10-100" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-101"><a href="#cb10-101" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-102"><a href="#cb10-102" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For each possible sequence</span></span>
<span id="cb10-103"><a href="#cb10-103" aria-hidden="true" tabindex="-1"></a>    total_seq <span class="ot">&lt;-</span> <span class="fu">nrow</span>(sequences)</span>
<span id="cb10-104"><a href="#cb10-104" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>total_seq) {</span>
<span id="cb10-105"><a href="#cb10-105" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Print progress indicator</span></span>
<span id="cb10-106"><a href="#cb10-106" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (i <span class="sc">%%</span> <span class="dv">10</span> <span class="sc">==</span> <span class="dv">0</span> <span class="sc">||</span> i <span class="sc">==</span> <span class="dv">1</span> <span class="sc">||</span> i <span class="sc">==</span> total_seq) {</span>
<span id="cb10-107"><a href="#cb10-107" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"  Processing sequence %d of %d (%.1f%%)</span><span class="sc">\n</span><span class="st">"</span>, i, total_seq, i<span class="sc">/</span>total_seq<span class="sc">*</span><span class="dv">100</span>))</span>
<span id="cb10-108"><a href="#cb10-108" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb10-109"><a href="#cb10-109" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb10-110"><a href="#cb10-110" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Get current sequence</span></span>
<span id="cb10-111"><a href="#cb10-111" aria-hidden="true" tabindex="-1"></a>      seq <span class="ot">&lt;-</span> sequences[i,]</span>
<span id="cb10-112"><a href="#cb10-112" aria-hidden="true" tabindex="-1"></a>      seq_str <span class="ot">&lt;-</span> seq_strings[[i]]</span>
<span id="cb10-113"><a href="#cb10-113" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb10-114"><a href="#cb10-114" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Probability weights</span></span>
<span id="cb10-115"><a href="#cb10-115" aria-hidden="true" tabindex="-1"></a>      prob_good <span class="ot">&lt;-</span> probs_good[i]</span>
<span id="cb10-116"><a href="#cb10-116" aria-hidden="true" tabindex="-1"></a>      prob_bad <span class="ot">&lt;-</span> probs_bad[i]</span>
<span id="cb10-117"><a href="#cb10-117" aria-hidden="true" tabindex="-1"></a>      seq_weight <span class="ot">&lt;-</span> p <span class="sc">*</span> prob_good <span class="sc">+</span> (<span class="fl">1.0</span> <span class="sc">-</span> p) <span class="sc">*</span> prob_bad</span>
<span id="cb10-118"><a href="#cb10-118" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb10-119"><a href="#cb10-119" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Skip sequences with near-zero probability to save computation</span></span>
<span id="cb10-120"><a href="#cb10-120" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (seq_weight <span class="sc">&lt;</span> <span class="fl">1e-10</span>) {</span>
<span id="cb10-121"><a href="#cb10-121" aria-hidden="true" tabindex="-1"></a>        <span class="cf">next</span></span>
<span id="cb10-122"><a href="#cb10-122" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb10-123"><a href="#cb10-123" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb10-124"><a href="#cb10-124" aria-hidden="true" tabindex="-1"></a>      <span class="co"># For each AI type</span></span>
<span id="cb10-125"><a href="#cb10-125" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (ai_type <span class="cf">in</span> config<span class="sc">$</span>ai_types) {</span>
<span id="cb10-126"><a href="#cb10-126" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Tracking correctness measures</span></span>
<span id="cb10-127"><a href="#cb10-127" aria-hidden="true" tabindex="-1"></a>        correct_ex_ante <span class="ot">&lt;-</span> <span class="fl">0.0</span></span>
<span id="cb10-128"><a href="#cb10-128" aria-hidden="true" tabindex="-1"></a>        correct_ex_post_good <span class="ot">&lt;-</span> <span class="fl">0.0</span></span>
<span id="cb10-129"><a href="#cb10-129" aria-hidden="true" tabindex="-1"></a>        correct_ex_post_bad <span class="ot">&lt;-</span> <span class="fl">0.0</span></span>
<span id="cb10-130"><a href="#cb10-130" aria-hidden="true" tabindex="-1"></a>        correct_ex_post_payoff <span class="ot">&lt;-</span> <span class="fl">0.0</span></span>
<span id="cb10-131"><a href="#cb10-131" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-132"><a href="#cb10-132" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Forced choice measures</span></span>
<span id="cb10-133"><a href="#cb10-133" aria-hidden="true" tabindex="-1"></a>        forced_ex_ante <span class="ot">&lt;-</span> <span class="fl">0.0</span></span>
<span id="cb10-134"><a href="#cb10-134" aria-hidden="true" tabindex="-1"></a>        forced_ex_post_type <span class="ot">&lt;-</span> <span class="fl">0.0</span></span>
<span id="cb10-135"><a href="#cb10-135" aria-hidden="true" tabindex="-1"></a>        forced_ex_post_payoff <span class="ot">&lt;-</span> <span class="fl">0.0</span></span>
<span id="cb10-136"><a href="#cb10-136" aria-hidden="true" tabindex="-1"></a>        forced_cases <span class="ot">&lt;-</span> <span class="fl">0.0</span></span>
<span id="cb10-137"><a href="#cb10-137" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-138"><a href="#cb10-138" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Pre-allocate observed vector for better performance</span></span>
<span id="cb10-139"><a href="#cb10-139" aria-hidden="true" tabindex="-1"></a>        observed <span class="ot">&lt;-</span> <span class="fu">character</span>(<span class="dv">0</span>)</span>
<span id="cb10-140"><a href="#cb10-140" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-141"><a href="#cb10-141" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Simulate the AI observing outcomes one by one</span></span>
<span id="cb10-142"><a href="#cb10-142" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(seq_str)) {</span>
<span id="cb10-143"><a href="#cb10-143" aria-hidden="true" tabindex="-1"></a>          outcome <span class="ot">&lt;-</span> seq_str[t]</span>
<span id="cb10-144"><a href="#cb10-144" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb10-145"><a href="#cb10-145" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Get AI recommendation based on observations so far</span></span>
<span id="cb10-146"><a href="#cb10-146" aria-hidden="true" tabindex="-1"></a>          current_trial <span class="ot">&lt;-</span> <span class="fu">length</span>(observed)</span>
<span id="cb10-147"><a href="#cb10-147" aria-hidden="true" tabindex="-1"></a>          ai_rec <span class="ot">&lt;-</span> <span class="fu">get_ai_recommendation</span>(ai_type, p, observed, current_trial, config)</span>
<span id="cb10-148"><a href="#cb10-148" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb10-149"><a href="#cb10-149" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Calculate true Bayesian posterior for EV measure</span></span>
<span id="cb10-150"><a href="#cb10-150" aria-hidden="true" tabindex="-1"></a>          true_posterior_good <span class="ot">&lt;-</span> <span class="fu">calculate_posterior</span>(<span class="st">"perfect"</span>, p, observed, current_trial, config)</span>
<span id="cb10-151"><a href="#cb10-151" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb10-152"><a href="#cb10-152" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Calculate expected return for checking EV ties</span></span>
<span id="cb10-153"><a href="#cb10-153" aria-hidden="true" tabindex="-1"></a>          expected_return <span class="ot">&lt;-</span> <span class="fu">calculate_expected_return</span>(true_posterior_good, config)</span>
<span id="cb10-154"><a href="#cb10-154" aria-hidden="true" tabindex="-1"></a>          is_ev_tie <span class="ot">&lt;-</span> <span class="fu">abs</span>(expected_return <span class="sc">-</span> config<span class="sc">$</span>bond_payoff) <span class="sc">&lt;</span> <span class="fl">1e-10</span></span>
<span id="cb10-155"><a href="#cb10-155" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb10-156"><a href="#cb10-156" aria-hidden="true" tabindex="-1"></a>          <span class="co"># 1) Ex-Ante correctness</span></span>
<span id="cb10-157"><a href="#cb10-157" aria-hidden="true" tabindex="-1"></a>          ex_ante_correct <span class="ot">&lt;-</span> <span class="fu">measure_ex_ante_correctness</span>(ai_rec, true_posterior_good, config)</span>
<span id="cb10-158"><a href="#cb10-158" aria-hidden="true" tabindex="-1"></a>          correct_ex_ante <span class="ot">&lt;-</span> correct_ex_ante <span class="sc">+</span> ex_ante_correct</span>
<span id="cb10-159"><a href="#cb10-159" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb10-160"><a href="#cb10-160" aria-hidden="true" tabindex="-1"></a>          <span class="co"># 2) Ex-Post (share-type) correctness</span></span>
<span id="cb10-161"><a href="#cb10-161" aria-hidden="true" tabindex="-1"></a>          ex_post_good_correct <span class="ot">&lt;-</span> <span class="fu">measure_ex_post_share_type</span>(ai_rec, <span class="st">"good"</span>)</span>
<span id="cb10-162"><a href="#cb10-162" aria-hidden="true" tabindex="-1"></a>          ex_post_bad_correct <span class="ot">&lt;-</span> <span class="fu">measure_ex_post_share_type</span>(ai_rec, <span class="st">"bad"</span>)</span>
<span id="cb10-163"><a href="#cb10-163" aria-hidden="true" tabindex="-1"></a>          correct_ex_post_good <span class="ot">&lt;-</span> correct_ex_post_good <span class="sc">+</span> ex_post_good_correct</span>
<span id="cb10-164"><a href="#cb10-164" aria-hidden="true" tabindex="-1"></a>          correct_ex_post_bad <span class="ot">&lt;-</span> correct_ex_post_bad <span class="sc">+</span> ex_post_bad_correct</span>
<span id="cb10-165"><a href="#cb10-165" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb10-166"><a href="#cb10-166" aria-hidden="true" tabindex="-1"></a>          <span class="co"># 3) Ex-Post (payoff-based) correctness</span></span>
<span id="cb10-167"><a href="#cb10-167" aria-hidden="true" tabindex="-1"></a>          ex_post_payoff_correct <span class="ot">&lt;-</span> <span class="fu">measure_ex_post_payoff</span>(ai_rec, outcome)</span>
<span id="cb10-168"><a href="#cb10-168" aria-hidden="true" tabindex="-1"></a>          correct_ex_post_payoff <span class="ot">&lt;-</span> correct_ex_post_payoff <span class="sc">+</span> ex_post_payoff_correct</span>
<span id="cb10-169"><a href="#cb10-169" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb10-170"><a href="#cb10-170" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Forced choice metrics - only count when not a tie</span></span>
<span id="cb10-171"><a href="#cb10-171" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="sc">!</span>is_ev_tie) {</span>
<span id="cb10-172"><a href="#cb10-172" aria-hidden="true" tabindex="-1"></a>            forced_cases <span class="ot">&lt;-</span> forced_cases <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb10-173"><a href="#cb10-173" aria-hidden="true" tabindex="-1"></a>            forced_ex_ante <span class="ot">&lt;-</span> forced_ex_ante <span class="sc">+</span> ex_ante_correct</span>
<span id="cb10-174"><a href="#cb10-174" aria-hidden="true" tabindex="-1"></a>            forced_ex_post_type <span class="ot">&lt;-</span> forced_ex_post_type <span class="sc">+</span> </span>
<span id="cb10-175"><a href="#cb10-175" aria-hidden="true" tabindex="-1"></a>              (p <span class="sc">*</span> prob_good <span class="sc">*</span> ex_post_good_correct <span class="sc">+</span> (<span class="fl">1.0</span> <span class="sc">-</span> p) <span class="sc">*</span> prob_bad <span class="sc">*</span> ex_post_bad_correct) <span class="sc">/</span> seq_weight</span>
<span id="cb10-176"><a href="#cb10-176" aria-hidden="true" tabindex="-1"></a>            forced_ex_post_payoff <span class="ot">&lt;-</span> forced_ex_post_payoff <span class="sc">+</span> ex_post_payoff_correct</span>
<span id="cb10-177"><a href="#cb10-177" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb10-178"><a href="#cb10-178" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb10-179"><a href="#cb10-179" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Update observed outcomes for next trial</span></span>
<span id="cb10-180"><a href="#cb10-180" aria-hidden="true" tabindex="-1"></a>          observed <span class="ot">&lt;-</span> <span class="fu">c</span>(observed, outcome)</span>
<span id="cb10-181"><a href="#cb10-181" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb10-182"><a href="#cb10-182" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-183"><a href="#cb10-183" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Update measure sums with sequence-weighted correctness</span></span>
<span id="cb10-184"><a href="#cb10-184" aria-hidden="true" tabindex="-1"></a>        measure_sums[[ai_type]]<span class="sc">$</span>ex_ante <span class="ot">&lt;-</span> </span>
<span id="cb10-185"><a href="#cb10-185" aria-hidden="true" tabindex="-1"></a>          measure_sums[[ai_type]]<span class="sc">$</span>ex_ante <span class="sc">+</span> correct_ex_ante <span class="sc">*</span> seq_weight</span>
<span id="cb10-186"><a href="#cb10-186" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-187"><a href="#cb10-187" aria-hidden="true" tabindex="-1"></a>        measure_sums[[ai_type]]<span class="sc">$</span>ex_post_type <span class="ot">&lt;-</span> </span>
<span id="cb10-188"><a href="#cb10-188" aria-hidden="true" tabindex="-1"></a>          measure_sums[[ai_type]]<span class="sc">$</span>ex_post_type <span class="sc">+</span> </span>
<span id="cb10-189"><a href="#cb10-189" aria-hidden="true" tabindex="-1"></a>          (correct_ex_post_good <span class="sc">*</span> (p <span class="sc">*</span> prob_good) <span class="sc">+</span> correct_ex_post_bad <span class="sc">*</span> ((<span class="fl">1.0</span> <span class="sc">-</span> p) <span class="sc">*</span> prob_bad))</span>
<span id="cb10-190"><a href="#cb10-190" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-191"><a href="#cb10-191" aria-hidden="true" tabindex="-1"></a>        measure_sums[[ai_type]]<span class="sc">$</span>ex_post_payoff <span class="ot">&lt;-</span> </span>
<span id="cb10-192"><a href="#cb10-192" aria-hidden="true" tabindex="-1"></a>          measure_sums[[ai_type]]<span class="sc">$</span>ex_post_payoff <span class="sc">+</span> correct_ex_post_payoff <span class="sc">*</span> seq_weight</span>
<span id="cb10-193"><a href="#cb10-193" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-194"><a href="#cb10-194" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Update forced choice measures if we had any non-tie cases</span></span>
<span id="cb10-195"><a href="#cb10-195" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (forced_cases <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb10-196"><a href="#cb10-196" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Weight by sequence probability</span></span>
<span id="cb10-197"><a href="#cb10-197" aria-hidden="true" tabindex="-1"></a>          forced_sums[[ai_type]]<span class="sc">$</span>ex_ante <span class="ot">&lt;-</span> </span>
<span id="cb10-198"><a href="#cb10-198" aria-hidden="true" tabindex="-1"></a>            forced_sums[[ai_type]]<span class="sc">$</span>ex_ante <span class="sc">+</span> forced_ex_ante <span class="sc">*</span> seq_weight</span>
<span id="cb10-199"><a href="#cb10-199" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb10-200"><a href="#cb10-200" aria-hidden="true" tabindex="-1"></a>          forced_sums[[ai_type]]<span class="sc">$</span>ex_post_type <span class="ot">&lt;-</span> </span>
<span id="cb10-201"><a href="#cb10-201" aria-hidden="true" tabindex="-1"></a>            forced_sums[[ai_type]]<span class="sc">$</span>ex_post_type <span class="sc">+</span> forced_ex_post_type <span class="sc">*</span> seq_weight</span>
<span id="cb10-202"><a href="#cb10-202" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb10-203"><a href="#cb10-203" aria-hidden="true" tabindex="-1"></a>          forced_sums[[ai_type]]<span class="sc">$</span>ex_post_payoff <span class="ot">&lt;-</span> </span>
<span id="cb10-204"><a href="#cb10-204" aria-hidden="true" tabindex="-1"></a>            forced_sums[[ai_type]]<span class="sc">$</span>ex_post_payoff <span class="sc">+</span> forced_ex_post_payoff <span class="sc">*</span> seq_weight</span>
<span id="cb10-205"><a href="#cb10-205" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb10-206"><a href="#cb10-206" aria-hidden="true" tabindex="-1"></a>          forced_sums[[ai_type]]<span class="sc">$</span>total_cases <span class="ot">&lt;-</span> </span>
<span id="cb10-207"><a href="#cb10-207" aria-hidden="true" tabindex="-1"></a>            forced_sums[[ai_type]]<span class="sc">$</span>total_cases <span class="sc">+</span> forced_cases <span class="sc">*</span> seq_weight</span>
<span id="cb10-208"><a href="#cb10-208" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb10-209"><a href="#cb10-209" aria-hidden="true" tabindex="-1"></a>          forced_sums[[ai_type]]<span class="sc">$</span>total_weight <span class="ot">&lt;-</span> </span>
<span id="cb10-210"><a href="#cb10-210" aria-hidden="true" tabindex="-1"></a>            forced_sums[[ai_type]]<span class="sc">$</span>total_weight <span class="sc">+</span> config<span class="sc">$</span>num_trials <span class="sc">*</span> seq_weight</span>
<span id="cb10-211"><a href="#cb10-211" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb10-212"><a href="#cb10-212" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb10-213"><a href="#cb10-213" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-214"><a href="#cb10-214" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-215"><a href="#cb10-215" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Process results for this prior probability</span></span>
<span id="cb10-216"><a href="#cb10-216" aria-hidden="true" tabindex="-1"></a>    standard_for_p <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb10-217"><a href="#cb10-217" aria-hidden="true" tabindex="-1"></a>    forced_for_p <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb10-218"><a href="#cb10-218" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-219"><a href="#cb10-219" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (ai_type <span class="cf">in</span> config<span class="sc">$</span>ai_types) {</span>
<span id="cb10-220"><a href="#cb10-220" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Convert sums to fractions by dividing by number of trials</span></span>
<span id="cb10-221"><a href="#cb10-221" aria-hidden="true" tabindex="-1"></a>      standard_for_p[[ai_type]] <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb10-222"><a href="#cb10-222" aria-hidden="true" tabindex="-1"></a>        <span class="at">ex_ante =</span> measure_sums[[ai_type]]<span class="sc">$</span>ex_ante <span class="sc">/</span> config<span class="sc">$</span>num_trials,</span>
<span id="cb10-223"><a href="#cb10-223" aria-hidden="true" tabindex="-1"></a>        <span class="at">ex_post_type =</span> measure_sums[[ai_type]]<span class="sc">$</span>ex_post_type <span class="sc">/</span> config<span class="sc">$</span>num_trials,</span>
<span id="cb10-224"><a href="#cb10-224" aria-hidden="true" tabindex="-1"></a>        <span class="at">ex_post_payoff =</span> measure_sums[[ai_type]]<span class="sc">$</span>ex_post_payoff <span class="sc">/</span> config<span class="sc">$</span>num_trials</span>
<span id="cb10-225"><a href="#cb10-225" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb10-226"><a href="#cb10-226" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb10-227"><a href="#cb10-227" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Calculate forced choice metrics</span></span>
<span id="cb10-228"><a href="#cb10-228" aria-hidden="true" tabindex="-1"></a>      total_forced_cases <span class="ot">&lt;-</span> forced_sums[[ai_type]]<span class="sc">$</span>total_cases</span>
<span id="cb10-229"><a href="#cb10-229" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (total_forced_cases <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb10-230"><a href="#cb10-230" aria-hidden="true" tabindex="-1"></a>        forced_for_p[[ai_type]] <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb10-231"><a href="#cb10-231" aria-hidden="true" tabindex="-1"></a>          <span class="at">ex_ante =</span> forced_sums[[ai_type]]<span class="sc">$</span>ex_ante <span class="sc">/</span> total_forced_cases,</span>
<span id="cb10-232"><a href="#cb10-232" aria-hidden="true" tabindex="-1"></a>          <span class="at">ex_post_type =</span> forced_sums[[ai_type]]<span class="sc">$</span>ex_post_type <span class="sc">/</span> total_forced_cases,</span>
<span id="cb10-233"><a href="#cb10-233" aria-hidden="true" tabindex="-1"></a>          <span class="at">ex_post_payoff =</span> forced_sums[[ai_type]]<span class="sc">$</span>ex_post_payoff <span class="sc">/</span> total_forced_cases,</span>
<span id="cb10-234"><a href="#cb10-234" aria-hidden="true" tabindex="-1"></a>          <span class="at">pct_included =</span> (total_forced_cases <span class="sc">/</span> forced_sums[[ai_type]]<span class="sc">$</span>total_weight) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb10-235"><a href="#cb10-235" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb10-236"><a href="#cb10-236" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb10-237"><a href="#cb10-237" aria-hidden="true" tabindex="-1"></a>        forced_for_p[[ai_type]] <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb10-238"><a href="#cb10-238" aria-hidden="true" tabindex="-1"></a>          <span class="at">ex_ante =</span> <span class="cn">NaN</span>,</span>
<span id="cb10-239"><a href="#cb10-239" aria-hidden="true" tabindex="-1"></a>          <span class="at">ex_post_type =</span> <span class="cn">NaN</span>,</span>
<span id="cb10-240"><a href="#cb10-240" aria-hidden="true" tabindex="-1"></a>          <span class="at">ex_post_payoff =</span> <span class="cn">NaN</span>,</span>
<span id="cb10-241"><a href="#cb10-241" aria-hidden="true" tabindex="-1"></a>          <span class="at">pct_included =</span> <span class="dv">0</span></span>
<span id="cb10-242"><a href="#cb10-242" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb10-243"><a href="#cb10-243" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb10-244"><a href="#cb10-244" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-245"><a href="#cb10-245" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-246"><a href="#cb10-246" aria-hidden="true" tabindex="-1"></a>    standard_results[[<span class="fu">as.character</span>(p)]] <span class="ot">&lt;-</span> standard_for_p</span>
<span id="cb10-247"><a href="#cb10-247" aria-hidden="true" tabindex="-1"></a>    forced_results[[<span class="fu">as.character</span>(p)]] <span class="ot">&lt;-</span> forced_for_p</span>
<span id="cb10-248"><a href="#cb10-248" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-249"><a href="#cb10-249" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-250"><a href="#cb10-250" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">standard_results =</span> standard_results, </span>
<span id="cb10-251"><a href="#cb10-251" aria-hidden="true" tabindex="-1"></a>              <span class="at">forced_results =</span> forced_results))</span>
<span id="cb10-252"><a href="#cb10-252" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="visualisation-and-reporting-functions" class="level3">
<h3 class="anchored" data-anchor-id="visualisation-and-reporting-functions">Visualisation and reporting functions</h3>
<p>This section defines functions for creating summary visualisations of the results:</p>
<ul>
<li><code>create_performance_summary</code>: Creates a bar chart comparing the overall performance of all AI models using both traditional and EV-based accuracy measures.</li>
<li><code>plot_performance_by_prior</code>: Creates bar charts showing the performance of AI models across different prior probabilities, using both traditional and EV-based accuracy measures.</li>
<li><code>create_dynamic_x_ticks</code>: Helper for dynamic x-ticks in plots.</li>
<li><code>plot_accuracy_by_trial</code>: Creates a plot visualizing the accuracy of AI models across trials for different prior probabilities.</li>
<li><code>plot_combined_accuracy_by_trial</code>: Creates a combined plot visualizing the accuracy of AI models across trials for different prior probabilities.</li>
<li><code>plot_analytical_performance_by_prior</code>: Creates a plot visualizing the analytical performance of AI models across different prior probabilities.</li>
<li><code>create_table_from_results</code> takes the results dictionaries (containing accuracy data) and a <code>table_type</code> parameter to create formatted tables summarizing the AI models’ performance. It takes three parameters and creates either a summary table (overall AI performance) or a prior probability table (performance for each prior).
<ul>
<li><code>results</code>: A dictionary containing the traditional accuracy results from the simulations.</li>
<li><code>ev_results</code>: A dictionary containing the expected value (EV)-based accuracy results from the simulations.</li>
<li><code>table_type</code>: A string indicating the type of table to generate (“summary” or “prior”).</li>
</ul></li>
<li><code>plot_trial_by_trial_performance</code>: Creates a plot visualizing the traditional accuracy of AI models across trials for different prior probabilities.</li>
<li><code>display_forced_choice_results</code>: Displays the forced choice results in a formatted table.</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualisation Functions</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a performance summary chart comparing all AI models</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>create_performance_summary <span class="ot">&lt;-</span> <span class="cf">function</span>(results, config) {</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a clear performance summary chart comparing all AI models</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate average accuracy across all priors for all measures</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  ex_ante_accuracy <span class="ot">&lt;-</span> <span class="fu">list</span>()      <span class="co"># EV-based</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  ex_post_type_accuracy <span class="ot">&lt;-</span> <span class="fu">list</span>() <span class="co"># Traditional</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  ex_post_payoff_accuracy <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (ai_type <span class="cf">in</span> config<span class="sc">$</span>ai_types) {</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate average accuracy across all priors</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    ex_ante_sum <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">sapply</span>(config<span class="sc">$</span>p, <span class="cf">function</span>(p) results[[<span class="fu">as.character</span>(p)]][[ai_type]]<span class="sc">$</span>ex_ante))</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    ex_post_type_sum <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">sapply</span>(config<span class="sc">$</span>p, <span class="cf">function</span>(p) results[[<span class="fu">as.character</span>(p)]][[ai_type]]<span class="sc">$</span>ex_post_type))</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    ex_post_payoff_sum <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">sapply</span>(config<span class="sc">$</span>p, <span class="cf">function</span>(p) results[[<span class="fu">as.character</span>(p)]][[ai_type]]<span class="sc">$</span>ex_post_payoff))</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Average across priors</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    ex_ante_accuracy[[ai_type]] <span class="ot">&lt;-</span> ex_ante_sum <span class="sc">/</span> <span class="fu">length</span>(config<span class="sc">$</span>p)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    ex_post_type_accuracy[[ai_type]] <span class="ot">&lt;-</span> ex_post_type_sum <span class="sc">/</span> <span class="fu">length</span>(config<span class="sc">$</span>p)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    ex_post_payoff_accuracy[[ai_type]] <span class="ot">&lt;-</span> ex_post_payoff_sum <span class="sc">/</span> <span class="fu">length</span>(config<span class="sc">$</span>p)</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create dataframe for plotting</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  summary_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (ai_type <span class="cf">in</span> config<span class="sc">$</span>ai_types) {</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    new_rows <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">ai_type =</span> <span class="fu">c</span>(ai_type, ai_type, ai_type),</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">accuracy_measure =</span> <span class="fu">c</span>(<span class="st">"Ex-Ante"</span>, <span class="st">"Ex-Post Type"</span>, <span class="st">"Ex-Post Payoff"</span>),</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">accuracy =</span> <span class="fu">c</span>(ex_ante_accuracy[[ai_type]], </span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>                  ex_post_type_accuracy[[ai_type]], </span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>                  ex_post_payoff_accuracy[[ai_type]])</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>    summary_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(summary_data, new_rows)</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Capitalize AI type for display</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>  summary_data<span class="sc">$</span>ai_type <span class="ot">&lt;-</span> <span class="fu">str_to_title</span>(summary_data<span class="sc">$</span>ai_type)</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set custom ordering to ensure perfect first, conservative next, naive last</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>  ordered_ai_types <span class="ot">&lt;-</span> <span class="fu">str_to_title</span>(config<span class="sc">$</span>ai_types)</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Move perfect, conservative and naive to specific positions</span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>  perfect_idx <span class="ot">&lt;-</span> <span class="fu">which</span>(ordered_ai_types <span class="sc">==</span> <span class="st">"Perfect"</span>)</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>  conservative_idx <span class="ot">&lt;-</span> <span class="fu">which</span>(ordered_ai_types <span class="sc">==</span> <span class="st">"Conservative"</span>)</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>  naive_idx <span class="ot">&lt;-</span> <span class="fu">which</span>(ordered_ai_types <span class="sc">==</span> <span class="st">"Naive prior"</span>)</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(perfect_idx) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>    ordered_ai_types <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Perfect"</span>, ordered_ai_types[<span class="sc">-</span>perfect_idx])</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(conservative_idx) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> conservative_idx <span class="sc">!=</span> <span class="dv">2</span>) {</span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove conservative from current position</span></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>    temp_order <span class="ot">&lt;-</span> ordered_ai_types[ordered_ai_types <span class="sc">!=</span> <span class="st">"Conservative"</span>]</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Re-insert at position 2 or at the end if there's only one item</span></span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(temp_order) <span class="sc">&gt;=</span> <span class="dv">1</span>) {</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>      ordered_ai_types <span class="ot">&lt;-</span> <span class="fu">c</span>(temp_order[<span class="dv">1</span>], <span class="st">"Conservative"</span>, temp_order[<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>      ordered_ai_types <span class="ot">&lt;-</span> <span class="fu">c</span>(temp_order, <span class="st">"Conservative"</span>)</span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(naive_idx) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>    ordered_ai_types <span class="ot">&lt;-</span> <span class="fu">c</span>(ordered_ai_types[ordered_ai_types <span class="sc">!=</span> <span class="st">"Naive prior"</span>], <span class="st">"Naive prior"</span>)</span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>  summary_data<span class="sc">$</span>ai_type <span class="ot">&lt;-</span> <span class="fu">factor</span>(summary_data<span class="sc">$</span>ai_type, <span class="at">levels =</span> ordered_ai_types)</span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define correct order for accuracy measures</span></span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a>  summary_data<span class="sc">$</span>accuracy_measure <span class="ot">&lt;-</span> <span class="fu">factor</span>(summary_data<span class="sc">$</span>accuracy_measure, </span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Ex-Ante"</span>, <span class="st">"Ex-Post Type"</span>, <span class="st">"Ex-Post Payoff"</span>))</span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create plot with consistent appearance to Python version</span></span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>  plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(summary_data, <span class="fu">aes</span>(<span class="at">x =</span> ai_type, <span class="at">y =</span> accuracy, <span class="at">fill =</span> accuracy_measure)) <span class="sc">+</span></span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.8</span>), <span class="at">width =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), </span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.2</span>),</span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>()) <span class="sc">+</span></span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Ex-Ante"</span> <span class="ot">=</span> <span class="st">"#2ecc71"</span>,       <span class="co"># Green</span></span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Ex-Post Type"</span> <span class="ot">=</span> <span class="st">"#3498db"</span>,  <span class="co"># Blue</span></span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Ex-Post Payoff"</span> <span class="ot">=</span> <span class="st">"#e67e22"</span> <span class="co"># Orange</span></span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">+</span></span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"AI Performance Comparison"</span>,</span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"AI Model"</span>,</span>
<span id="cb11-84"><a href="#cb11-84" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Accuracy (%)"</span>,</span>
<span id="cb11-85"><a href="#cb11-85" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> <span class="st">"Accuracy Measure"</span></span>
<span id="cb11-86"><a href="#cb11-86" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb11-87"><a href="#cb11-87" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb11-88"><a href="#cb11-88" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb11-89"><a href="#cb11-89" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb11-90"><a href="#cb11-90" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb11-91"><a href="#cb11-91" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb11-92"><a href="#cb11-92" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Move legend to bottom right with smaller size</span></span>
<span id="cb11-93"><a href="#cb11-93" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.9</span>, <span class="fl">0.08</span>),</span>
<span id="cb11-94"><a href="#cb11-94" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb11-95"><a href="#cb11-95" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.box.just =</span> <span class="st">"right"</span>,</span>
<span id="cb11-96"><a href="#cb11-96" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.margin =</span> <span class="fu">margin</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>),</span>
<span id="cb11-97"><a href="#cb11-97" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>),</span>
<span id="cb11-98"><a href="#cb11-98" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">5</span>),</span>
<span id="cb11-99"><a href="#cb11-99" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">"lines"</span>),</span>
<span id="cb11-100"><a href="#cb11-100" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">color =</span> <span class="st">"gray80"</span>),</span>
<span id="cb11-101"><a href="#cb11-101" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray80"</span>, <span class="at">linewidth =</span> <span class="fl">0.4</span>),</span>
<span id="cb11-102"><a href="#cb11-102" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb11-103"><a href="#cb11-103" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb11-104"><a href="#cb11-104" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="st">"cm"</span>)</span>
<span id="cb11-105"><a href="#cb11-105" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb11-106"><a href="#cb11-106" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%.1f%%"</span>, accuracy <span class="sc">*</span> <span class="dv">100</span>)), </span>
<span id="cb11-107"><a href="#cb11-107" aria-hidden="true" tabindex="-1"></a>              <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.8</span>),</span>
<span id="cb11-108"><a href="#cb11-108" aria-hidden="true" tabindex="-1"></a>              <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, </span>
<span id="cb11-109"><a href="#cb11-109" aria-hidden="true" tabindex="-1"></a>              <span class="at">fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb11-110"><a href="#cb11-110" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> <span class="fl">3.5</span>)</span>
<span id="cb11-111"><a href="#cb11-111" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-112"><a href="#cb11-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(plot)</span>
<span id="cb11-113"><a href="#cb11-113" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-114"><a href="#cb11-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-115"><a href="#cb11-115" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot performance by prior probability</span></span>
<span id="cb11-116"><a href="#cb11-116" aria-hidden="true" tabindex="-1"></a>plot_performance_by_prior <span class="ot">&lt;-</span> <span class="cf">function</span>(results, config, <span class="at">result_type =</span> <span class="st">"simulation"</span>) {</span>
<span id="cb11-117"><a href="#cb11-117" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prepare data for plotting</span></span>
<span id="cb11-118"><a href="#cb11-118" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb11-119"><a href="#cb11-119" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-120"><a href="#cb11-120" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (p <span class="cf">in</span> config<span class="sc">$</span>p) {</span>
<span id="cb11-121"><a href="#cb11-121" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (ai_type <span class="cf">in</span> config<span class="sc">$</span>ai_types) {</span>
<span id="cb11-122"><a href="#cb11-122" aria-hidden="true" tabindex="-1"></a>      ex_ante <span class="ot">&lt;-</span> results[[<span class="fu">as.character</span>(p)]][[ai_type]]<span class="sc">$</span>ex_ante</span>
<span id="cb11-123"><a href="#cb11-123" aria-hidden="true" tabindex="-1"></a>      ex_post_type <span class="ot">&lt;-</span> results[[<span class="fu">as.character</span>(p)]][[ai_type]]<span class="sc">$</span>ex_post_type</span>
<span id="cb11-124"><a href="#cb11-124" aria-hidden="true" tabindex="-1"></a>      ex_post_payoff <span class="ot">&lt;-</span> results[[<span class="fu">as.character</span>(p)]][[ai_type]]<span class="sc">$</span>ex_post_payoff</span>
<span id="cb11-125"><a href="#cb11-125" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb11-126"><a href="#cb11-126" aria-hidden="true" tabindex="-1"></a>      new_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb11-127"><a href="#cb11-127" aria-hidden="true" tabindex="-1"></a>        <span class="at">Prior_Probability =</span> p,</span>
<span id="cb11-128"><a href="#cb11-128" aria-hidden="true" tabindex="-1"></a>        <span class="at">AI_Type =</span> <span class="fu">str_to_title</span>(ai_type),</span>
<span id="cb11-129"><a href="#cb11-129" aria-hidden="true" tabindex="-1"></a>        <span class="at">Statistical_Optimality =</span> ex_ante,</span>
<span id="cb11-130"><a href="#cb11-130" aria-hidden="true" tabindex="-1"></a>        <span class="at">Correct_Predictions =</span> ex_post_type,</span>
<span id="cb11-131"><a href="#cb11-131" aria-hidden="true" tabindex="-1"></a>        <span class="at">Payoff_Accuracy =</span> ex_post_payoff</span>
<span id="cb11-132"><a href="#cb11-132" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb11-133"><a href="#cb11-133" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb11-134"><a href="#cb11-134" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data, new_row)</span>
<span id="cb11-135"><a href="#cb11-135" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-136"><a href="#cb11-136" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-137"><a href="#cb11-137" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-138"><a href="#cb11-138" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set custom ordering to ensure perfect first, conservative next, naive last</span></span>
<span id="cb11-139"><a href="#cb11-139" aria-hidden="true" tabindex="-1"></a>  ordered_ai_types <span class="ot">&lt;-</span> <span class="fu">str_to_title</span>(config<span class="sc">$</span>ai_types)</span>
<span id="cb11-140"><a href="#cb11-140" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Move perfect, conservative and naive to specific positions</span></span>
<span id="cb11-141"><a href="#cb11-141" aria-hidden="true" tabindex="-1"></a>  perfect_idx <span class="ot">&lt;-</span> <span class="fu">which</span>(ordered_ai_types <span class="sc">==</span> <span class="st">"Perfect"</span>)</span>
<span id="cb11-142"><a href="#cb11-142" aria-hidden="true" tabindex="-1"></a>  conservative_idx <span class="ot">&lt;-</span> <span class="fu">which</span>(ordered_ai_types <span class="sc">==</span> <span class="st">"Conservative"</span>)</span>
<span id="cb11-143"><a href="#cb11-143" aria-hidden="true" tabindex="-1"></a>  naive_idx <span class="ot">&lt;-</span> <span class="fu">which</span>(ordered_ai_types <span class="sc">==</span> <span class="st">"Naive prior"</span>)</span>
<span id="cb11-144"><a href="#cb11-144" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-145"><a href="#cb11-145" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(perfect_idx) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb11-146"><a href="#cb11-146" aria-hidden="true" tabindex="-1"></a>    ordered_ai_types <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Perfect"</span>, ordered_ai_types[<span class="sc">-</span>perfect_idx])</span>
<span id="cb11-147"><a href="#cb11-147" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-148"><a href="#cb11-148" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(conservative_idx) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> conservative_idx <span class="sc">!=</span> <span class="dv">2</span>) {</span>
<span id="cb11-149"><a href="#cb11-149" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove conservative from current position</span></span>
<span id="cb11-150"><a href="#cb11-150" aria-hidden="true" tabindex="-1"></a>    temp_order <span class="ot">&lt;-</span> ordered_ai_types[ordered_ai_types <span class="sc">!=</span> <span class="st">"Conservative"</span>]</span>
<span id="cb11-151"><a href="#cb11-151" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Re-insert at position 2 or at the end if there's only one item</span></span>
<span id="cb11-152"><a href="#cb11-152" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(temp_order) <span class="sc">&gt;=</span> <span class="dv">1</span>) {</span>
<span id="cb11-153"><a href="#cb11-153" aria-hidden="true" tabindex="-1"></a>      ordered_ai_types <span class="ot">&lt;-</span> <span class="fu">c</span>(temp_order[<span class="dv">1</span>], <span class="st">"Conservative"</span>, temp_order[<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb11-154"><a href="#cb11-154" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb11-155"><a href="#cb11-155" aria-hidden="true" tabindex="-1"></a>      ordered_ai_types <span class="ot">&lt;-</span> <span class="fu">c</span>(temp_order, <span class="st">"Conservative"</span>)</span>
<span id="cb11-156"><a href="#cb11-156" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-157"><a href="#cb11-157" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-158"><a href="#cb11-158" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(naive_idx) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb11-159"><a href="#cb11-159" aria-hidden="true" tabindex="-1"></a>    ordered_ai_types <span class="ot">&lt;-</span> <span class="fu">c</span>(ordered_ai_types[ordered_ai_types <span class="sc">!=</span> <span class="st">"Naive prior"</span>], <span class="st">"Naive prior"</span>)</span>
<span id="cb11-160"><a href="#cb11-160" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-161"><a href="#cb11-161" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-162"><a href="#cb11-162" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set the AI_Type as a factor with the desired order</span></span>
<span id="cb11-163"><a href="#cb11-163" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>AI_Type <span class="ot">&lt;-</span> <span class="fu">factor</span>(data<span class="sc">$</span>AI_Type, <span class="at">levels =</span> ordered_ai_types)</span>
<span id="cb11-164"><a href="#cb11-164" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-165"><a href="#cb11-165" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define metric names</span></span>
<span id="cb11-166"><a href="#cb11-166" aria-hidden="true" tabindex="-1"></a>  metric_names <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb11-167"><a href="#cb11-167" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Statistical_Optimality"</span> <span class="ot">=</span> <span class="st">"Statistical Optimality"</span>,</span>
<span id="cb11-168"><a href="#cb11-168" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Correct_Predictions"</span> <span class="ot">=</span> <span class="st">"Correct Predictions"</span>, </span>
<span id="cb11-169"><a href="#cb11-169" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Payoff_Accuracy"</span> <span class="ot">=</span> <span class="st">"Payoff Accuracy"</span></span>
<span id="cb11-170"><a href="#cb11-170" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-171"><a href="#cb11-171" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-172"><a href="#cb11-172" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a separate plot for each metric</span></span>
<span id="cb11-173"><a href="#cb11-173" aria-hidden="true" tabindex="-1"></a>  plot_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb11-174"><a href="#cb11-174" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-175"><a href="#cb11-175" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Color palettes</span></span>
<span id="cb11-176"><a href="#cb11-176" aria-hidden="true" tabindex="-1"></a>  green_palette <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"#b3e6b3"</span>, <span class="st">"#1a5e3b"</span>))(<span class="fu">length</span>(config<span class="sc">$</span>ai_types))</span>
<span id="cb11-177"><a href="#cb11-177" aria-hidden="true" tabindex="-1"></a>  blue_palette <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"#deebf7"</span>, <span class="st">"#3182bd"</span>))(<span class="fu">length</span>(config<span class="sc">$</span>ai_types))</span>
<span id="cb11-178"><a href="#cb11-178" aria-hidden="true" tabindex="-1"></a>  orange_palette <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"#fee6ce"</span>, <span class="st">"#e6550d"</span>))(<span class="fu">length</span>(config<span class="sc">$</span>ai_types))</span>
<span id="cb11-179"><a href="#cb11-179" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-180"><a href="#cb11-180" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create plots for each metric</span></span>
<span id="cb11-181"><a href="#cb11-181" aria-hidden="true" tabindex="-1"></a>  metrics <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Statistical_Optimality"</span>, <span class="st">"Correct_Predictions"</span>, <span class="st">"Payoff_Accuracy"</span>)</span>
<span id="cb11-182"><a href="#cb11-182" aria-hidden="true" tabindex="-1"></a>  palettes <span class="ot">&lt;-</span> <span class="fu">list</span>(green_palette, blue_palette, orange_palette)</span>
<span id="cb11-183"><a href="#cb11-183" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-184"><a href="#cb11-184" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(metrics)) {</span>
<span id="cb11-185"><a href="#cb11-185" aria-hidden="true" tabindex="-1"></a>    metric <span class="ot">&lt;-</span> metrics[i]</span>
<span id="cb11-186"><a href="#cb11-186" aria-hidden="true" tabindex="-1"></a>    palette <span class="ot">&lt;-</span> palettes[[i]]</span>
<span id="cb11-187"><a href="#cb11-187" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-188"><a href="#cb11-188" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get data for this metric</span></span>
<span id="cb11-189"><a href="#cb11-189" aria-hidden="true" tabindex="-1"></a>    plot_data <span class="ot">&lt;-</span> data[, <span class="fu">c</span>(<span class="st">"Prior_Probability"</span>, <span class="st">"AI_Type"</span>, metric)]</span>
<span id="cb11-190"><a href="#cb11-190" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(plot_data)[<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="st">"Value"</span></span>
<span id="cb11-191"><a href="#cb11-191" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-192"><a href="#cb11-192" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create plot</span></span>
<span id="cb11-193"><a href="#cb11-193" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(plot_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(Prior_Probability), <span class="at">y =</span> Value, <span class="at">fill =</span> AI_Type)) <span class="sc">+</span></span>
<span id="cb11-194"><a href="#cb11-194" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb11-195"><a href="#cb11-195" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.05</span>), <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>()) <span class="sc">+</span></span>
<span id="cb11-196"><a href="#cb11-196" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">setNames</span>(palette, <span class="fu">levels</span>(<span class="fu">factor</span>(plot_data<span class="sc">$</span>AI_Type)))) <span class="sc">+</span></span>
<span id="cb11-197"><a href="#cb11-197" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(</span>
<span id="cb11-198"><a href="#cb11-198" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> metric_names[metric],</span>
<span id="cb11-199"><a href="#cb11-199" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Prior Probability"</span>,</span>
<span id="cb11-200"><a href="#cb11-200" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Accuracy"</span></span>
<span id="cb11-201"><a href="#cb11-201" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb11-202"><a href="#cb11-202" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb11-203"><a href="#cb11-203" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(</span>
<span id="cb11-204"><a href="#cb11-204" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add smaller legend to bottom right of each plot</span></span>
<span id="cb11-205"><a href="#cb11-205" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.9</span>, <span class="fl">0.08</span>),</span>
<span id="cb11-206"><a href="#cb11-206" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb11-207"><a href="#cb11-207" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">color =</span> <span class="st">"gray80"</span>),</span>
<span id="cb11-208"><a href="#cb11-208" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.margin =</span> <span class="fu">margin</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb11-209"><a href="#cb11-209" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="fl">0.4</span>, <span class="st">"lines"</span>),</span>
<span id="cb11-210"><a href="#cb11-210" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>),</span>
<span id="cb11-211"><a href="#cb11-211" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">5</span>),</span>
<span id="cb11-212"><a href="#cb11-212" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray80"</span>),</span>
<span id="cb11-213"><a href="#cb11-213" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb11-214"><a href="#cb11-214" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb11-215"><a href="#cb11-215" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb11-216"><a href="#cb11-216" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb11-217"><a href="#cb11-217" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-218"><a href="#cb11-218" aria-hidden="true" tabindex="-1"></a>    plot_list[[metric]] <span class="ot">&lt;-</span> p</span>
<span id="cb11-219"><a href="#cb11-219" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-220"><a href="#cb11-220" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-221"><a href="#cb11-221" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set main title based on result type</span></span>
<span id="cb11-222"><a href="#cb11-222" aria-hidden="true" tabindex="-1"></a>  main_title <span class="ot">&lt;-</span> <span class="cf">if</span>(result_type <span class="sc">==</span> <span class="st">"analytical"</span>) {</span>
<span id="cb11-223"><a href="#cb11-223" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Analytical AI Performance by Prior Probability"</span></span>
<span id="cb11-224"><a href="#cb11-224" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span>(result_type <span class="sc">==</span> <span class="st">"analytical_forced"</span>) {</span>
<span id="cb11-225"><a href="#cb11-225" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Analytical AI Performance (Excluding EV Ties) by Prior Probability"</span></span>
<span id="cb11-226"><a href="#cb11-226" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span>(result_type <span class="sc">==</span> <span class="st">"forced"</span>) {</span>
<span id="cb11-227"><a href="#cb11-227" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Simulation AI Performance (Excluding EV Ties) by Prior Probability"</span></span>
<span id="cb11-228"><a href="#cb11-228" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb11-229"><a href="#cb11-229" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Simulation AI Performance by Prior Probability"</span></span>
<span id="cb11-230"><a href="#cb11-230" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-231"><a href="#cb11-231" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-232"><a href="#cb11-232" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Arrange plots in a grid</span></span>
<span id="cb11-233"><a href="#cb11-233" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> gridExtra<span class="sc">::</span><span class="fu">arrangeGrob</span>(</span>
<span id="cb11-234"><a href="#cb11-234" aria-hidden="true" tabindex="-1"></a>    plot_list[[<span class="st">"Statistical_Optimality"</span>]],</span>
<span id="cb11-235"><a href="#cb11-235" aria-hidden="true" tabindex="-1"></a>    plot_list[[<span class="st">"Correct_Predictions"</span>]],</span>
<span id="cb11-236"><a href="#cb11-236" aria-hidden="true" tabindex="-1"></a>    plot_list[[<span class="st">"Payoff_Accuracy"</span>]],</span>
<span id="cb11-237"><a href="#cb11-237" aria-hidden="true" tabindex="-1"></a>    <span class="at">ncol =</span> <span class="dv">3</span>,</span>
<span id="cb11-238"><a href="#cb11-238" aria-hidden="true" tabindex="-1"></a>    <span class="at">top =</span> main_title</span>
<span id="cb11-239"><a href="#cb11-239" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-240"><a href="#cb11-240" aria-hidden="true" tabindex="-1"></a>  grid<span class="sc">::</span><span class="fu">grid.draw</span>(p)</span>
<span id="cb11-241"><a href="#cb11-241" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">invisible</span>(p))</span>
<span id="cb11-242"><a href="#cb11-242" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-243"><a href="#cb11-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-244"><a href="#cb11-244" aria-hidden="true" tabindex="-1"></a><span class="co"># Dynamic grid function for plotting</span></span>
<span id="cb11-245"><a href="#cb11-245" aria-hidden="true" tabindex="-1"></a>create_dynamic_x_ticks <span class="ot">&lt;-</span> <span class="cf">function</span>(max_trials) {</span>
<span id="cb11-246"><a href="#cb11-246" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create dynamic x-ticks based on the number of trials:</span></span>
<span id="cb11-247"><a href="#cb11-247" aria-hidden="true" tabindex="-1"></a>  <span class="co"># - If max_trials &lt;= 11: Show grid lines for all trials</span></span>
<span id="cb11-248"><a href="#cb11-248" aria-hidden="true" tabindex="-1"></a>  <span class="co"># - If max_trials &gt; 11: Show grid lines for odd-numbered trials plus the last trial if even</span></span>
<span id="cb11-249"><a href="#cb11-249" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb11-250"><a href="#cb11-250" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Args:</span></span>
<span id="cb11-251"><a href="#cb11-251" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   max_trials: Maximum number of trials</span></span>
<span id="cb11-252"><a href="#cb11-252" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb11-253"><a href="#cb11-253" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Returns:</span></span>
<span id="cb11-254"><a href="#cb11-254" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   Vector of x-tick positions</span></span>
<span id="cb11-255"><a href="#cb11-255" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-256"><a href="#cb11-256" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (max_trials <span class="sc">&lt;=</span> <span class="dv">11</span>) {</span>
<span id="cb11-257"><a href="#cb11-257" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If 11 or fewer trials, show all</span></span>
<span id="cb11-258"><a href="#cb11-258" aria-hidden="true" tabindex="-1"></a>    x_ticks <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>max_trials</span>
<span id="cb11-259"><a href="#cb11-259" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb11-260"><a href="#cb11-260" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For more than 11 trials, show odd-numbered trials</span></span>
<span id="cb11-261"><a href="#cb11-261" aria-hidden="true" tabindex="-1"></a>    x_ticks <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>, max_trials, <span class="at">by =</span> <span class="dv">2</span>)</span>
<span id="cb11-262"><a href="#cb11-262" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-263"><a href="#cb11-263" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Always include the last trial if it's not already included (if it's even)</span></span>
<span id="cb11-264"><a href="#cb11-264" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (max_trials <span class="sc">%%</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="sc">!</span>(max_trials <span class="sc">%in%</span> x_ticks)) {</span>
<span id="cb11-265"><a href="#cb11-265" aria-hidden="true" tabindex="-1"></a>      x_ticks <span class="ot">&lt;-</span> <span class="fu">c</span>(x_ticks, max_trials)</span>
<span id="cb11-266"><a href="#cb11-266" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-267"><a href="#cb11-267" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-268"><a href="#cb11-268" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-269"><a href="#cb11-269" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">sort</span>(x_ticks))</span>
<span id="cb11-270"><a href="#cb11-270" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-271"><a href="#cb11-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-272"><a href="#cb11-272" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot_accuracy_by_trial function</span></span>
<span id="cb11-273"><a href="#cb11-273" aria-hidden="true" tabindex="-1"></a>plot_accuracy_by_trial <span class="ot">&lt;-</span> <span class="cf">function</span>(trial_df, <span class="at">accuracy_measure =</span> <span class="st">"ev_accuracy"</span>,</span>
<span id="cb11-274"><a href="#cb11-274" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">title_prefix =</span> <span class="st">"AI"</span>, <span class="at">config =</span> <span class="cn">NULL</span>) {</span>
<span id="cb11-275"><a href="#cb11-275" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Plot accuracy across trials for all AI types with dynamic grid</span></span>
<span id="cb11-276"><a href="#cb11-276" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb11-277"><a href="#cb11-277" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Args:</span></span>
<span id="cb11-278"><a href="#cb11-278" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   trial_df: DataFrame with trial-by-trial data</span></span>
<span id="cb11-279"><a href="#cb11-279" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   accuracy_measure: Column name for the accuracy measure to plot</span></span>
<span id="cb11-280"><a href="#cb11-280" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   title_prefix: Prefix for the plot title</span></span>
<span id="cb11-281"><a href="#cb11-281" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   config: Simulation configuration parameters</span></span>
<span id="cb11-282"><a href="#cb11-282" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb11-283"><a href="#cb11-283" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Returns:</span></span>
<span id="cb11-284"><a href="#cb11-284" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   ggplot object</span></span>
<span id="cb11-285"><a href="#cb11-285" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-286"><a href="#cb11-286" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Group by prior, trial, and AI type to get average performance</span></span>
<span id="cb11-287"><a href="#cb11-287" aria-hidden="true" tabindex="-1"></a>  grouped <span class="ot">&lt;-</span> trial_df <span class="sc">%&gt;%</span></span>
<span id="cb11-288"><a href="#cb11-288" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(prior, trial, ai_type) <span class="sc">%&gt;%</span></span>
<span id="cb11-289"><a href="#cb11-289" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">mean_accuracy =</span> <span class="fu">mean</span>(<span class="sc">!!</span><span class="fu">sym</span>(accuracy_measure)), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb11-290"><a href="#cb11-290" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-291"><a href="#cb11-291" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Determine the max number of trials</span></span>
<span id="cb11-292"><a href="#cb11-292" aria-hidden="true" tabindex="-1"></a>  max_trials <span class="ot">&lt;-</span> <span class="fu">max</span>(trial_df<span class="sc">$</span>trial)</span>
<span id="cb11-293"><a href="#cb11-293" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-294"><a href="#cb11-294" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create dynamic x-ticks</span></span>
<span id="cb11-295"><a href="#cb11-295" aria-hidden="true" tabindex="-1"></a>  x_ticks <span class="ot">&lt;-</span> <span class="fu">create_dynamic_x_ticks</span>(max_trials)</span>
<span id="cb11-296"><a href="#cb11-296" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-297"><a href="#cb11-297" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Map accuracy measures to readable labels</span></span>
<span id="cb11-298"><a href="#cb11-298" aria-hidden="true" tabindex="-1"></a>  measure_labels <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb11-299"><a href="#cb11-299" aria-hidden="true" tabindex="-1"></a>    <span class="at">ev_accuracy =</span> <span class="st">"Statistical Optimality"</span>,</span>
<span id="cb11-300"><a href="#cb11-300" aria-hidden="true" tabindex="-1"></a>    <span class="at">rec_accuracy =</span> <span class="st">"Ex-Post Type Accuracy"</span>,</span>
<span id="cb11-301"><a href="#cb11-301" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome_accuracy =</span> <span class="st">"Ex-Post Payoff Accuracy"</span></span>
<span id="cb11-302"><a href="#cb11-302" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-303"><a href="#cb11-303" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-304"><a href="#cb11-304" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(measure_labels[[accuracy_measure]])) {</span>
<span id="cb11-305"><a href="#cb11-305" aria-hidden="true" tabindex="-1"></a>    measure_label <span class="ot">&lt;-</span> measure_labels[[accuracy_measure]]</span>
<span id="cb11-306"><a href="#cb11-306" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb11-307"><a href="#cb11-307" aria-hidden="true" tabindex="-1"></a>    measure_label <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"_"</span>, <span class="st">" "</span>, <span class="fu">str_to_title</span>(accuracy_measure))</span>
<span id="cb11-308"><a href="#cb11-308" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-309"><a href="#cb11-309" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-310"><a href="#cb11-310" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create plot </span></span>
<span id="cb11-311"><a href="#cb11-311" aria-hidden="true" tabindex="-1"></a>  plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(grouped, <span class="fu">aes</span>(<span class="at">x =</span> trial, <span class="at">y =</span> mean_accuracy, <span class="at">color =</span> ai_type, <span class="at">group =</span> ai_type)) <span class="sc">+</span></span>
<span id="cb11-312"><a href="#cb11-312" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb11-313"><a href="#cb11-313" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb11-314"><a href="#cb11-314" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb11-315"><a href="#cb11-315" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> x_ticks) <span class="sc">+</span></span>
<span id="cb11-316"><a href="#cb11-316" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.05</span>)) <span class="sc">+</span></span>
<span id="cb11-317"><a href="#cb11-317" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb11-318"><a href="#cb11-318" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(title_prefix, measure_label, <span class="st">"Across Trials"</span>),</span>
<span id="cb11-319"><a href="#cb11-319" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Trial Number"</span>,</span>
<span id="cb11-320"><a href="#cb11-320" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> measure_label,</span>
<span id="cb11-321"><a href="#cb11-321" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"AI Type"</span></span>
<span id="cb11-322"><a href="#cb11-322" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb11-323"><a href="#cb11-323" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb11-324"><a href="#cb11-324" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb11-325"><a href="#cb11-325" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"gray90"</span>),</span>
<span id="cb11-326"><a href="#cb11-326" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb11-327"><a href="#cb11-327" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"bottom"</span></span>
<span id="cb11-328"><a href="#cb11-328" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb11-329"><a href="#cb11-329" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> prior, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">labeller =</span> <span class="fu">labeller</span>(<span class="at">prior =</span> <span class="cf">function</span>(x) <span class="fu">paste0</span>(<span class="st">"Prior p = "</span>, x)))</span>
<span id="cb11-330"><a href="#cb11-330" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-331"><a href="#cb11-331" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(plot)</span>
<span id="cb11-332"><a href="#cb11-332" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-333"><a href="#cb11-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-334"><a href="#cb11-334" aria-hidden="true" tabindex="-1"></a>plot_combined_accuracy_by_trial <span class="ot">&lt;-</span> <span class="cf">function</span>(trial_df, config) {</span>
<span id="cb11-335"><a href="#cb11-335" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Plot all three accuracy measures side by side for each prior probability</span></span>
<span id="cb11-336"><a href="#cb11-336" aria-hidden="true" tabindex="-1"></a>  <span class="co"># with dynamic grid that adjusts to trial count</span></span>
<span id="cb11-337"><a href="#cb11-337" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb11-338"><a href="#cb11-338" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Args:</span></span>
<span id="cb11-339"><a href="#cb11-339" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   trial_df: DataFrame with trial-by-trial data</span></span>
<span id="cb11-340"><a href="#cb11-340" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   config: Simulation configuration parameters</span></span>
<span id="cb11-341"><a href="#cb11-341" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb11-342"><a href="#cb11-342" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Returns:</span></span>
<span id="cb11-343"><a href="#cb11-343" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   List of ggplot objects</span></span>
<span id="cb11-344"><a href="#cb11-344" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-345"><a href="#cb11-345" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate mean values for each measure by prior, trial, and AI type</span></span>
<span id="cb11-346"><a href="#cb11-346" aria-hidden="true" tabindex="-1"></a>  ex_ante_grouped <span class="ot">&lt;-</span> trial_df <span class="sc">%&gt;%</span></span>
<span id="cb11-347"><a href="#cb11-347" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(prior, trial, ai_type) <span class="sc">%&gt;%</span></span>
<span id="cb11-348"><a href="#cb11-348" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">mean_accuracy =</span> <span class="fu">mean</span>(ev_accuracy), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-349"><a href="#cb11-349" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">measure =</span> <span class="st">"Ex-Ante</span><span class="sc">\n</span><span class="st">Statistical Optimality"</span>)</span>
<span id="cb11-350"><a href="#cb11-350" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-351"><a href="#cb11-351" aria-hidden="true" tabindex="-1"></a>  ex_post_type_grouped <span class="ot">&lt;-</span> trial_df <span class="sc">%&gt;%</span></span>
<span id="cb11-352"><a href="#cb11-352" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(prior, trial, ai_type) <span class="sc">%&gt;%</span></span>
<span id="cb11-353"><a href="#cb11-353" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">mean_accuracy =</span> <span class="fu">mean</span>(rec_accuracy), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-354"><a href="#cb11-354" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">measure =</span> <span class="st">"Ex-Post Type</span><span class="sc">\n</span><span class="st">Correct Predictions"</span>)</span>
<span id="cb11-355"><a href="#cb11-355" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-356"><a href="#cb11-356" aria-hidden="true" tabindex="-1"></a>  ex_post_payoff_grouped <span class="ot">&lt;-</span> trial_df <span class="sc">%&gt;%</span></span>
<span id="cb11-357"><a href="#cb11-357" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(prior, trial, ai_type) <span class="sc">%&gt;%</span></span>
<span id="cb11-358"><a href="#cb11-358" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">mean_accuracy =</span> <span class="fu">mean</span>(outcome_accuracy), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-359"><a href="#cb11-359" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">measure =</span> <span class="st">"Ex-Post Payoff</span><span class="sc">\n</span><span class="st">Payoff-Based Accuracy"</span>)</span>
<span id="cb11-360"><a href="#cb11-360" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-361"><a href="#cb11-361" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combine all data</span></span>
<span id="cb11-362"><a href="#cb11-362" aria-hidden="true" tabindex="-1"></a>  all_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(ex_ante_grouped, ex_post_type_grouped, ex_post_payoff_grouped)</span>
<span id="cb11-363"><a href="#cb11-363" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-364"><a href="#cb11-364" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Determine the max number of trials</span></span>
<span id="cb11-365"><a href="#cb11-365" aria-hidden="true" tabindex="-1"></a>  max_trials <span class="ot">&lt;-</span> <span class="fu">max</span>(trial_df<span class="sc">$</span>trial)</span>
<span id="cb11-366"><a href="#cb11-366" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-367"><a href="#cb11-367" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create dynamic x-ticks</span></span>
<span id="cb11-368"><a href="#cb11-368" aria-hidden="true" tabindex="-1"></a>  x_ticks <span class="ot">&lt;-</span> <span class="fu">create_dynamic_x_ticks</span>(max_trials)</span>
<span id="cb11-369"><a href="#cb11-369" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-370"><a href="#cb11-370" aria-hidden="true" tabindex="-1"></a>  all_data<span class="sc">$</span>ai_type <span class="ot">&lt;-</span> <span class="fu">factor</span>(all_data<span class="sc">$</span>ai_type, <span class="at">levels =</span> config<span class="sc">$</span>ai_types)</span>
<span id="cb11-371"><a href="#cb11-371" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-372"><a href="#cb11-372" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define measure order</span></span>
<span id="cb11-373"><a href="#cb11-373" aria-hidden="true" tabindex="-1"></a>  ordered_measures <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Ex-Ante</span><span class="sc">\n</span><span class="st">Statistical Optimality"</span>, </span>
<span id="cb11-374"><a href="#cb11-374" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Ex-Post Type</span><span class="sc">\n</span><span class="st">Correct Predictions"</span>, </span>
<span id="cb11-375"><a href="#cb11-375" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Ex-Post Payoff</span><span class="sc">\n</span><span class="st">Payoff-Based Accuracy"</span>)</span>
<span id="cb11-376"><a href="#cb11-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-377"><a href="#cb11-377" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert measure to a factor with the right order</span></span>
<span id="cb11-378"><a href="#cb11-378" aria-hidden="true" tabindex="-1"></a>  all_data<span class="sc">$</span>measure <span class="ot">&lt;-</span> <span class="fu">factor</span>(all_data<span class="sc">$</span>measure, <span class="at">levels =</span> ordered_measures)</span>
<span id="cb11-379"><a href="#cb11-379" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-380"><a href="#cb11-380" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create plot with facets</span></span>
<span id="cb11-381"><a href="#cb11-381" aria-hidden="true" tabindex="-1"></a>  plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_data, <span class="fu">aes</span>(<span class="at">x =</span> trial, <span class="at">y =</span> mean_accuracy, <span class="at">color =</span> ai_type, <span class="at">group =</span> ai_type)) <span class="sc">+</span></span>
<span id="cb11-382"><a href="#cb11-382" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb11-383"><a href="#cb11-383" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb11-384"><a href="#cb11-384" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>, </span>
<span id="cb11-385"><a href="#cb11-385" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">str_to_title</span>(<span class="fu">unique</span>(trial_df<span class="sc">$</span>ai_type))) <span class="sc">+</span></span>
<span id="cb11-386"><a href="#cb11-386" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> x_ticks) <span class="sc">+</span></span>
<span id="cb11-387"><a href="#cb11-387" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.05</span>)) <span class="sc">+</span></span>
<span id="cb11-388"><a href="#cb11-388" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb11-389"><a href="#cb11-389" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Trial Number"</span>,</span>
<span id="cb11-390"><a href="#cb11-390" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Accuracy"</span>,</span>
<span id="cb11-391"><a href="#cb11-391" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"AI Type"</span></span>
<span id="cb11-392"><a href="#cb11-392" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb11-393"><a href="#cb11-393" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb11-394"><a href="#cb11-394" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb11-395"><a href="#cb11-395" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"gray90"</span>),</span>
<span id="cb11-396"><a href="#cb11-396" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb11-397"><a href="#cb11-397" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb11-398"><a href="#cb11-398" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb11-399"><a href="#cb11-399" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb11-400"><a href="#cb11-400" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(prior <span class="sc">~</span> measure, </span>
<span id="cb11-401"><a href="#cb11-401" aria-hidden="true" tabindex="-1"></a>               <span class="at">labeller =</span> <span class="fu">labeller</span>(<span class="at">prior =</span> <span class="cf">function</span>(x) <span class="fu">paste0</span>(<span class="st">"Prior p = "</span>, x)))</span>
<span id="cb11-402"><a href="#cb11-402" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-403"><a href="#cb11-403" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(plot)</span>
<span id="cb11-404"><a href="#cb11-404" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-405"><a href="#cb11-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-406"><a href="#cb11-406" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot trial performance</span></span>
<span id="cb11-407"><a href="#cb11-407" aria-hidden="true" tabindex="-1"></a>plot_trial_by_trial_performance <span class="ot">&lt;-</span> <span class="cf">function</span>(trial_df, config) {</span>
<span id="cb11-408"><a href="#cb11-408" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Plot performance across trials for all AI types</span></span>
<span id="cb11-409"><a href="#cb11-409" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb11-410"><a href="#cb11-410" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Args:</span></span>
<span id="cb11-411"><a href="#cb11-411" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   trial_df: DataFrame with trial-by-trial data</span></span>
<span id="cb11-412"><a href="#cb11-412" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   config: Simulation configuration parameters</span></span>
<span id="cb11-413"><a href="#cb11-413" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb11-414"><a href="#cb11-414" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Returns:</span></span>
<span id="cb11-415"><a href="#cb11-415" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   List of ggplot objects, one for each prior</span></span>
<span id="cb11-416"><a href="#cb11-416" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-417"><a href="#cb11-417" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Group by prior, trial, and AI type to get average performance</span></span>
<span id="cb11-418"><a href="#cb11-418" aria-hidden="true" tabindex="-1"></a>  grouped <span class="ot">&lt;-</span> trial_df <span class="sc">%&gt;%</span></span>
<span id="cb11-419"><a href="#cb11-419" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(prior, trial, ai_type) <span class="sc">%&gt;%</span></span>
<span id="cb11-420"><a href="#cb11-420" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">rec_accuracy =</span> <span class="fu">mean</span>(rec_accuracy), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb11-421"><a href="#cb11-421" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-422"><a href="#cb11-422" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Determine max trials </span></span>
<span id="cb11-423"><a href="#cb11-423" aria-hidden="true" tabindex="-1"></a>  max_trials <span class="ot">&lt;-</span> <span class="fu">max</span>(trial_df<span class="sc">$</span>trial)</span>
<span id="cb11-424"><a href="#cb11-424" aria-hidden="true" tabindex="-1"></a>  x_ticks <span class="ot">&lt;-</span> <span class="fu">create_dynamic_x_ticks</span>(max_trials)</span>
<span id="cb11-425"><a href="#cb11-425" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-426"><a href="#cb11-426" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create plots for each prior</span></span>
<span id="cb11-427"><a href="#cb11-427" aria-hidden="true" tabindex="-1"></a>  plots <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb11-428"><a href="#cb11-428" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (p <span class="cf">in</span> <span class="fu">unique</span>(grouped<span class="sc">$</span>prior)) {</span>
<span id="cb11-429"><a href="#cb11-429" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> grouped <span class="sc">%&gt;%</span> <span class="fu">filter</span>(prior <span class="sc">==</span> p)</span>
<span id="cb11-430"><a href="#cb11-430" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-431"><a href="#cb11-431" aria-hidden="true" tabindex="-1"></a>    data<span class="sc">$</span>ai_type <span class="ot">&lt;-</span> <span class="fu">factor</span>(data<span class="sc">$</span>ai_type, <span class="at">levels =</span> config<span class="sc">$</span>ai_types)</span>
<span id="cb11-432"><a href="#cb11-432" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-433"><a href="#cb11-433" aria-hidden="true" tabindex="-1"></a>    plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> trial, <span class="at">y =</span> rec_accuracy, <span class="at">color =</span> ai_type, <span class="at">group =</span> ai_type)) <span class="sc">+</span></span>
<span id="cb11-434"><a href="#cb11-434" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb11-435"><a href="#cb11-435" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb11-436"><a href="#cb11-436" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb11-437"><a href="#cb11-437" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> x_ticks) <span class="sc">+</span></span>
<span id="cb11-438"><a href="#cb11-438" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.05</span>)) <span class="sc">+</span></span>
<span id="cb11-439"><a href="#cb11-439" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(</span>
<span id="cb11-440"><a href="#cb11-440" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"AI Correct Predictions Across Trials (Prior p ="</span>, p, <span class="st">")"</span>),</span>
<span id="cb11-441"><a href="#cb11-441" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Trial Number"</span>,</span>
<span id="cb11-442"><a href="#cb11-442" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Correct Prediction Rate"</span>,</span>
<span id="cb11-443"><a href="#cb11-443" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"AI Type"</span></span>
<span id="cb11-444"><a href="#cb11-444" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb11-445"><a href="#cb11-445" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb11-446"><a href="#cb11-446" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(</span>
<span id="cb11-447"><a href="#cb11-447" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"gray90"</span>),</span>
<span id="cb11-448"><a href="#cb11-448" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb11-449"><a href="#cb11-449" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span></span>
<span id="cb11-450"><a href="#cb11-450" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb11-451"><a href="#cb11-451" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-452"><a href="#cb11-452" aria-hidden="true" tabindex="-1"></a>    plots[[<span class="fu">as.character</span>(p)]] <span class="ot">&lt;-</span> plot</span>
<span id="cb11-453"><a href="#cb11-453" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-454"><a href="#cb11-454" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-455"><a href="#cb11-455" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(plots)</span>
<span id="cb11-456"><a href="#cb11-456" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-457"><a href="#cb11-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-458"><a href="#cb11-458" aria-hidden="true" tabindex="-1"></a><span class="co"># create_table_from_results function</span></span>
<span id="cb11-459"><a href="#cb11-459" aria-hidden="true" tabindex="-1"></a>create_table_from_results <span class="ot">&lt;-</span> <span class="cf">function</span>(results, ev_results, config, <span class="at">table_type =</span> <span class="st">"summary"</span>) {</span>
<span id="cb11-460"><a href="#cb11-460" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a dataframe to display the data in a tabular format</span></span>
<span id="cb11-461"><a href="#cb11-461" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb11-462"><a href="#cb11-462" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Args:</span></span>
<span id="cb11-463"><a href="#cb11-463" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   results: List with traditional accuracy results</span></span>
<span id="cb11-464"><a href="#cb11-464" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   ev_results: List with EV-based accuracy results</span></span>
<span id="cb11-465"><a href="#cb11-465" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   config: Simulation configuration parameters</span></span>
<span id="cb11-466"><a href="#cb11-466" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   table_type: "summary" or "prior" to indicate the type of table to generate</span></span>
<span id="cb11-467"><a href="#cb11-467" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb11-468"><a href="#cb11-468" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Returns:</span></span>
<span id="cb11-469"><a href="#cb11-469" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   A data frame containing the table data</span></span>
<span id="cb11-470"><a href="#cb11-470" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-471"><a href="#cb11-471" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (table_type <span class="sc">==</span> <span class="st">"summary"</span>) {</span>
<span id="cb11-472"><a href="#cb11-472" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Overall performance summary table</span></span>
<span id="cb11-473"><a href="#cb11-473" aria-hidden="true" tabindex="-1"></a>    trad_accuracy <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb11-474"><a href="#cb11-474" aria-hidden="true" tabindex="-1"></a>    ev_accuracy <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb11-475"><a href="#cb11-475" aria-hidden="true" tabindex="-1"></a>    payoff_accuracy <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb11-476"><a href="#cb11-476" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-477"><a href="#cb11-477" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (ai_type <span class="cf">in</span> config<span class="sc">$</span>ai_types) {</span>
<span id="cb11-478"><a href="#cb11-478" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Calculate overall accuracy across priors</span></span>
<span id="cb11-479"><a href="#cb11-479" aria-hidden="true" tabindex="-1"></a>      correct <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">sapply</span>(config<span class="sc">$</span>p, <span class="cf">function</span>(p) results[[<span class="fu">as.character</span>(p)]][[ai_type]]<span class="sc">$</span>correct))</span>
<span id="cb11-480"><a href="#cb11-480" aria-hidden="true" tabindex="-1"></a>      total <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">sapply</span>(config<span class="sc">$</span>p, <span class="cf">function</span>(p) results[[<span class="fu">as.character</span>(p)]][[ai_type]]<span class="sc">$</span>total))</span>
<span id="cb11-481"><a href="#cb11-481" aria-hidden="true" tabindex="-1"></a>      trad_accuracy[[ai_type]] <span class="ot">&lt;-</span> correct <span class="sc">/</span> total</span>
<span id="cb11-482"><a href="#cb11-482" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb11-483"><a href="#cb11-483" aria-hidden="true" tabindex="-1"></a>      ev_correct <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">sapply</span>(config<span class="sc">$</span>p, <span class="cf">function</span>(p) ev_results[[<span class="fu">as.character</span>(p)]][[ai_type]]<span class="sc">$</span>ev_correct))</span>
<span id="cb11-484"><a href="#cb11-484" aria-hidden="true" tabindex="-1"></a>      ev_total <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">sapply</span>(config<span class="sc">$</span>p, <span class="cf">function</span>(p) ev_results[[<span class="fu">as.character</span>(p)]][[ai_type]]<span class="sc">$</span>total))</span>
<span id="cb11-485"><a href="#cb11-485" aria-hidden="true" tabindex="-1"></a>      ev_accuracy[[ai_type]] <span class="ot">&lt;-</span> ev_correct <span class="sc">/</span> ev_total</span>
<span id="cb11-486"><a href="#cb11-486" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb11-487"><a href="#cb11-487" aria-hidden="true" tabindex="-1"></a>      payoff_correct <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">sapply</span>(config<span class="sc">$</span>p, <span class="cf">function</span>(p) results[[<span class="fu">as.character</span>(p)]][[ai_type]]<span class="sc">$</span>outcome_correct))</span>
<span id="cb11-488"><a href="#cb11-488" aria-hidden="true" tabindex="-1"></a>      payoff_total <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">sapply</span>(config<span class="sc">$</span>p, <span class="cf">function</span>(p) results[[<span class="fu">as.character</span>(p)]][[ai_type]]<span class="sc">$</span>total))</span>
<span id="cb11-489"><a href="#cb11-489" aria-hidden="true" tabindex="-1"></a>      payoff_accuracy[[ai_type]] <span class="ot">&lt;-</span> payoff_correct <span class="sc">/</span> payoff_total</span>
<span id="cb11-490"><a href="#cb11-490" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-491"><a href="#cb11-491" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-492"><a href="#cb11-492" aria-hidden="true" tabindex="-1"></a>    summary_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb11-493"><a href="#cb11-493" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (ai_type <span class="cf">in</span> config<span class="sc">$</span>ai_types) {</span>
<span id="cb11-494"><a href="#cb11-494" aria-hidden="true" tabindex="-1"></a>      new_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb11-495"><a href="#cb11-495" aria-hidden="true" tabindex="-1"></a>        <span class="at">AI_Type =</span> <span class="fu">str_to_title</span>(ai_type),</span>
<span id="cb11-496"><a href="#cb11-496" aria-hidden="true" tabindex="-1"></a>        <span class="at">Ex_Ante_Statistical_Optimality =</span> ev_accuracy[[ai_type]],</span>
<span id="cb11-497"><a href="#cb11-497" aria-hidden="true" tabindex="-1"></a>        <span class="at">Ex_Post_Type_Correct_Predictions =</span> trad_accuracy[[ai_type]],</span>
<span id="cb11-498"><a href="#cb11-498" aria-hidden="true" tabindex="-1"></a>        <span class="at">Ex_Post_Payoff_Accuracy =</span> payoff_accuracy[[ai_type]]</span>
<span id="cb11-499"><a href="#cb11-499" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb11-500"><a href="#cb11-500" aria-hidden="true" tabindex="-1"></a>      summary_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(summary_data, new_row)</span>
<span id="cb11-501"><a href="#cb11-501" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-502"><a href="#cb11-502" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-503"><a href="#cb11-503" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(summary_data)</span>
<span id="cb11-504"><a href="#cb11-504" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-505"><a href="#cb11-505" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (table_type <span class="sc">==</span> <span class="st">"prior"</span>) {</span>
<span id="cb11-506"><a href="#cb11-506" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Performance by prior probability table</span></span>
<span id="cb11-507"><a href="#cb11-507" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb11-508"><a href="#cb11-508" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (p <span class="cf">in</span> config<span class="sc">$</span>p) {</span>
<span id="cb11-509"><a href="#cb11-509" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (ai_type <span class="cf">in</span> config<span class="sc">$</span>ai_types) {</span>
<span id="cb11-510"><a href="#cb11-510" aria-hidden="true" tabindex="-1"></a>        trad_acc <span class="ot">&lt;-</span> results[[<span class="fu">as.character</span>(p)]][[ai_type]]<span class="sc">$</span>correct <span class="sc">/</span> results[[<span class="fu">as.character</span>(p)]][[ai_type]]<span class="sc">$</span>total</span>
<span id="cb11-511"><a href="#cb11-511" aria-hidden="true" tabindex="-1"></a>        ev_acc <span class="ot">&lt;-</span> ev_results[[<span class="fu">as.character</span>(p)]][[ai_type]]<span class="sc">$</span>ev_correct <span class="sc">/</span> ev_results[[<span class="fu">as.character</span>(p)]][[ai_type]]<span class="sc">$</span>total</span>
<span id="cb11-512"><a href="#cb11-512" aria-hidden="true" tabindex="-1"></a>        payoff_acc <span class="ot">&lt;-</span> results[[<span class="fu">as.character</span>(p)]][[ai_type]]<span class="sc">$</span>outcome_correct <span class="sc">/</span> results[[<span class="fu">as.character</span>(p)]][[ai_type]]<span class="sc">$</span>total</span>
<span id="cb11-513"><a href="#cb11-513" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb11-514"><a href="#cb11-514" aria-hidden="true" tabindex="-1"></a>        new_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb11-515"><a href="#cb11-515" aria-hidden="true" tabindex="-1"></a>          <span class="at">Prior_Probability =</span> p,</span>
<span id="cb11-516"><a href="#cb11-516" aria-hidden="true" tabindex="-1"></a>          <span class="at">AI_Type =</span> <span class="fu">str_to_title</span>(ai_type),</span>
<span id="cb11-517"><a href="#cb11-517" aria-hidden="true" tabindex="-1"></a>          <span class="at">Ex_Ante_Statistical_Optimality =</span> ev_acc,</span>
<span id="cb11-518"><a href="#cb11-518" aria-hidden="true" tabindex="-1"></a>          <span class="at">Ex_Post_Type_Correct_Predictions =</span> trad_acc,</span>
<span id="cb11-519"><a href="#cb11-519" aria-hidden="true" tabindex="-1"></a>          <span class="at">Ex_Post_Payoff_Accuracy =</span> payoff_acc</span>
<span id="cb11-520"><a href="#cb11-520" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb11-521"><a href="#cb11-521" aria-hidden="true" tabindex="-1"></a>        data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data, new_row)</span>
<span id="cb11-522"><a href="#cb11-522" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb11-523"><a href="#cb11-523" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-524"><a href="#cb11-524" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-525"><a href="#cb11-525" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(data)</span>
<span id="cb11-526"><a href="#cb11-526" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb11-527"><a href="#cb11-527" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb11-528"><a href="#cb11-528" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-529"><a href="#cb11-529" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-530"><a href="#cb11-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-531"><a href="#cb11-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-532"><a href="#cb11-532" aria-hidden="true" tabindex="-1"></a><span class="co"># Display results table function</span></span>
<span id="cb11-533"><a href="#cb11-533" aria-hidden="true" tabindex="-1"></a>display_results_table <span class="ot">&lt;-</span> <span class="cf">function</span>(results, config) {</span>
<span id="cb11-534"><a href="#cb11-534" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Number of trials num_trials=%d</span><span class="sc">\n\n</span><span class="st">"</span>, config<span class="sc">$</span>num_trials))</span>
<span id="cb11-535"><a href="#cb11-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-536"><a href="#cb11-536" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (p <span class="cf">in</span> config<span class="sc">$</span>p) {</span>
<span id="cb11-537"><a href="#cb11-537" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"===== p = %s =====</span><span class="sc">\n</span><span class="st">"</span>, p))</span>
<span id="cb11-538"><a href="#cb11-538" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (ai_type <span class="cf">in</span> config<span class="sc">$</span>ai_types) {</span>
<span id="cb11-539"><a href="#cb11-539" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Access metrics directly from results</span></span>
<span id="cb11-540"><a href="#cb11-540" aria-hidden="true" tabindex="-1"></a>      ex_ante <span class="ot">&lt;-</span> results[[<span class="fu">as.character</span>(p)]][[ai_type]]<span class="sc">$</span>ex_ante</span>
<span id="cb11-541"><a href="#cb11-541" aria-hidden="true" tabindex="-1"></a>      ex_post_type <span class="ot">&lt;-</span> results[[<span class="fu">as.character</span>(p)]][[ai_type]]<span class="sc">$</span>ex_post_type</span>
<span id="cb11-542"><a href="#cb11-542" aria-hidden="true" tabindex="-1"></a>      ex_post_payoff <span class="ot">&lt;-</span> results[[<span class="fu">as.character</span>(p)]][[ai_type]]<span class="sc">$</span>ex_post_payoff</span>
<span id="cb11-543"><a href="#cb11-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-544"><a href="#cb11-544" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"  %-15s =&gt; ex-ante=%.4f, ex-post-type=%.4f, ex-post-payoff=%.4f</span><span class="sc">\n</span><span class="st">"</span>, </span>
<span id="cb11-545"><a href="#cb11-545" aria-hidden="true" tabindex="-1"></a>                 ai_type, ex_ante, ex_post_type, ex_post_payoff))</span>
<span id="cb11-546"><a href="#cb11-546" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-547"><a href="#cb11-547" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb11-548"><a href="#cb11-548" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-549"><a href="#cb11-549" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-550"><a href="#cb11-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-551"><a href="#cb11-551" aria-hidden="true" tabindex="-1"></a><span class="co"># Display forced choice results function</span></span>
<span id="cb11-552"><a href="#cb11-552" aria-hidden="true" tabindex="-1"></a>display_forced_choice_results <span class="ot">&lt;-</span> <span class="cf">function</span>(forced_results, config) {</span>
<span id="cb11-553"><a href="#cb11-553" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">===== FORCED CHOICE ACCURACY (EXCLUDING EV TIES) =====</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb11-554"><a href="#cb11-554" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-555"><a href="#cb11-555" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (p <span class="cf">in</span> config<span class="sc">$</span>p) {</span>
<span id="cb11-556"><a href="#cb11-556" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Prior p = %s</span><span class="sc">\n</span><span class="st">"</span>, p))</span>
<span id="cb11-557"><a href="#cb11-557" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (ai_type <span class="cf">in</span> config<span class="sc">$</span>ai_types) {</span>
<span id="cb11-558"><a href="#cb11-558" aria-hidden="true" tabindex="-1"></a>      ex_ante <span class="ot">&lt;-</span> forced_results[[<span class="fu">as.character</span>(p)]][[ai_type]]<span class="sc">$</span>ex_ante</span>
<span id="cb11-559"><a href="#cb11-559" aria-hidden="true" tabindex="-1"></a>      ex_post_type <span class="ot">&lt;-</span> forced_results[[<span class="fu">as.character</span>(p)]][[ai_type]]<span class="sc">$</span>ex_post_type</span>
<span id="cb11-560"><a href="#cb11-560" aria-hidden="true" tabindex="-1"></a>      ex_post_payoff <span class="ot">&lt;-</span> forced_results[[<span class="fu">as.character</span>(p)]][[ai_type]]<span class="sc">$</span>ex_post_payoff</span>
<span id="cb11-561"><a href="#cb11-561" aria-hidden="true" tabindex="-1"></a>      pct_included <span class="ot">&lt;-</span> forced_results[[<span class="fu">as.character</span>(p)]][[ai_type]]<span class="sc">$</span>pct_included</span>
<span id="cb11-562"><a href="#cb11-562" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb11-563"><a href="#cb11-563" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">is.nan</span>(ex_ante)) {</span>
<span id="cb11-564"><a href="#cb11-564" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"  %-15s =&gt; N/A (no non-tie cases)</span><span class="sc">\n</span><span class="st">"</span>, ai_type))</span>
<span id="cb11-565"><a href="#cb11-565" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb11-566"><a href="#cb11-566" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"  %-15s =&gt; ex-ante=%.4f, ex-post-type=%.4f, ex-post-payoff=%.4f (using %.1f%% of trials)</span><span class="sc">\n</span><span class="st">"</span>, </span>
<span id="cb11-567"><a href="#cb11-567" aria-hidden="true" tabindex="-1"></a>                   ai_type, ex_ante, ex_post_type, ex_post_payoff, pct_included))</span>
<span id="cb11-568"><a href="#cb11-568" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb11-569"><a href="#cb11-569" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-570"><a href="#cb11-570" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb11-571"><a href="#cb11-571" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-572"><a href="#cb11-572" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="diagnostic-and-testing-functions" class="level3">
<h3 class="anchored" data-anchor-id="diagnostic-and-testing-functions">Diagnostic and Testing Functions</h3>
<p>This section includes functions for testing and validating the AI recommendations:</p>
<ul>
<li><strong><code>test_ai_recommendations</code>:</strong> Runs controlled scenarios to verify that the AI models are making expected recommendations in specific cases. This helps ensure the correctness of the simulation logic.</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Diagnostic and Testing Functions</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>test_ai_recommendations <span class="ot">&lt;-</span> <span class="cf">function</span>(config) {</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Function to test AI recommendations in controlled scenarios</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Args:</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   config: Simulation configuration parameters</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Testing AI recommendations in controlled scenarios...</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test case 1: Good share, perfect knowledge</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Case 1: Good share with perfect knowledge</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  true_share_type <span class="ot">&lt;-</span> <span class="st">"good"</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  correct_decision <span class="ot">&lt;-</span> <span class="fu">get_correct_decision</span>(true_share_type, config)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  ai_rec <span class="ot">&lt;-</span> <span class="fu">get_ai_recommendation</span>(<span class="st">"perfect"</span>, <span class="fl">0.5</span>, <span class="fu">c</span>(<span class="st">"high"</span>, <span class="st">"high"</span>, <span class="st">"high"</span>), <span class="dv">3</span>, config)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"True share type: %s</span><span class="sc">\n</span><span class="st">"</span>, true_share_type))</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Correct decision: %s</span><span class="sc">\n</span><span class="st">"</span>, correct_decision))</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Perfect AI recommendation: %s</span><span class="sc">\n</span><span class="st">"</span>, ai_rec))</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Match: %s</span><span class="sc">\n</span><span class="st">"</span>, ai_rec <span class="sc">==</span> correct_decision))</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test case 2: Bad share, perfect knowledge</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Case 2: Bad share with perfect knowledge</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  true_share_type <span class="ot">&lt;-</span> <span class="st">"bad"</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  correct_decision <span class="ot">&lt;-</span> <span class="fu">get_correct_decision</span>(true_share_type, config)</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  ai_rec <span class="ot">&lt;-</span> <span class="fu">get_ai_recommendation</span>(<span class="st">"perfect"</span>, <span class="fl">0.5</span>, <span class="fu">c</span>(<span class="st">"low"</span>, <span class="st">"low"</span>, <span class="st">"low"</span>), <span class="dv">3</span>, config)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"True share type: %s</span><span class="sc">\n</span><span class="st">"</span>, true_share_type))</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Correct decision: %s</span><span class="sc">\n</span><span class="st">"</span>, correct_decision))</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Perfect AI recommendation: %s</span><span class="sc">\n</span><span class="st">"</span>, ai_rec))</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Match: %s</span><span class="sc">\n</span><span class="st">"</span>, ai_rec <span class="sc">==</span> correct_decision))</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test Naive Prior AI progression</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Testing Naive Prior AI progression over trials...</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>  outcomes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"high"</span>, <span class="st">"high"</span>, <span class="st">"low"</span>, <span class="st">"high"</span>, <span class="st">"high"</span>, <span class="st">"low"</span>, <span class="st">"high"</span>, <span class="st">"high"</span>)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (trial <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(outcomes)) {</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    current_outcomes <span class="ot">&lt;-</span> <span class="cf">if</span> (trial <span class="sc">&gt;</span> <span class="dv">1</span>) outcomes[<span class="dv">1</span><span class="sc">:</span>(trial<span class="dv">-1</span>)] <span class="cf">else</span> <span class="fu">character</span>(<span class="dv">0</span>)</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    nH <span class="ot">&lt;-</span> <span class="fu">sum</span>(current_outcomes <span class="sc">==</span> <span class="st">"high"</span>)</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>    nL <span class="ot">&lt;-</span> <span class="fu">sum</span>(current_outcomes <span class="sc">==</span> <span class="st">"low"</span>)</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>    posterior <span class="ot">&lt;-</span> <span class="fu">calculate_posterior</span>(<span class="st">"naive_prior"</span>, <span class="fl">0.5</span>, current_outcomes, trial<span class="dv">-1</span>, config)</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>    expected_return <span class="ot">&lt;-</span> <span class="fu">calculate_expected_return</span>(posterior, config)</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>    recommendation <span class="ot">&lt;-</span> <span class="fu">get_ai_recommendation</span>(<span class="st">"naive_prior"</span>, <span class="fl">0.5</span>, current_outcomes, trial<span class="dv">-1</span>, config)</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Trial %d: High=%d, Low=%d, Posterior=%.4f, E[Return]=%.4f, Recommendation=%s</span><span class="sc">\n</span><span class="st">"</span>, </span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>               trial, nH, nL, posterior, expected_return, recommendation))</span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="main-execution-function" class="level3">
<h3 class="anchored" data-anchor-id="main-execution-function">Main Execution Function</h3>
<p>This section orchestrates the analysis process:</p>
<ul>
<li>It sets the number of simulations to run.</li>
<li>It runs the normal simulations and the EV-based simulations.</li>
<li>It performs detailed trial-by-trial analysis if enabled.</li>
<li>It returns all results in a dictionary.</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Main function</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Core execution functions without display logic</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>run_simulation_core <span class="ot">&lt;-</span> <span class="cf">function</span>(config, <span class="at">num_simulations =</span> <span class="cn">NULL</span>) {</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Just runs the simulation and returns results</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(num_simulations)) {</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    num_simulations <span class="ot">&lt;-</span> config<span class="sc">$</span>num_simulations</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Run simulations</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Running simulations (%d iterations per prior)...</span><span class="sc">\n</span><span class="st">"</span>, num_simulations))</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  sim_results <span class="ot">&lt;-</span> <span class="fu">run_all_simulations</span>(config, num_simulations)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(sim_results)</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>run_analytical_core <span class="ot">&lt;-</span> <span class="cf">function</span>(config) {</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Just runs analytical solution and returns results</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Calculating analytical solution...</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"This will enumerate 2^%d = %d possible sequences</span><span class="sc">\n</span><span class="st">"</span>, </span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>             config<span class="sc">$</span>num_trials, <span class="dv">2</span><span class="sc">^</span>config<span class="sc">$</span>num_trials))</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>  analytical_res <span class="ot">&lt;-</span> <span class="fu">run_all_measures</span>(config)</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(analytical_res)</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Setup and configuration</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>config <span class="ot">&lt;-</span> DEFAULT_CONFIG</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># You could modify config parameters here if needed</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># config$num_trials &lt;- 8  # Example modification</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test the AI recommendations to validate core logic</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">test_ai_recommendations</span>(config)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Testing AI recommendations in controlled scenarios...

Case 1: Good share with perfect knowledge
True share type: good
Correct decision: share
Perfect AI recommendation: share
Match: TRUE

Case 2: Bad share with perfect knowledge
True share type: bad
Correct decision: bond
Perfect AI recommendation: bond
Match: TRUE

Testing Naive Prior AI progression over trials...
Trial 1: High=0, Low=0, Posterior=0.5000, E[Return]=3.0000, Recommendation=indifferent
Trial 2: High=1, Low=0, Posterior=0.7000, E[Return]=3.3200, Recommendation=share
Trial 3: High=2, Low=0, Posterior=0.8448, E[Return]=3.5517, Recommendation=share
Trial 4: High=2, Low=1, Posterior=0.7000, E[Return]=3.3200, Recommendation=share
Trial 5: High=3, Low=1, Posterior=0.8448, E[Return]=3.5517, Recommendation=share
Trial 6: High=4, Low=1, Posterior=0.9270, E[Return]=3.6832, Recommendation=share
Trial 7: High=4, Low=2, Posterior=0.8448, E[Return]=3.5517, Recommendation=share
Trial 8: High=5, Low=2, Posterior=0.9270, E[Return]=3.6832, Recommendation=share</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the simulation analysis</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>sim_results <span class="ot">&lt;-</span> <span class="fu">run_simulation_core</span>(config)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Running simulations (1000 iterations per prior)...
Processing prior 1 of 3: p = 0.200000
  Simulation 100 of 1000 (10.0%)
  Simulation 200 of 1000 (20.0%)
  Simulation 300 of 1000 (30.0%)
  Simulation 400 of 1000 (40.0%)
  Simulation 500 of 1000 (50.0%)
  Simulation 600 of 1000 (60.0%)
  Simulation 700 of 1000 (70.0%)
  Simulation 800 of 1000 (80.0%)
  Simulation 900 of 1000 (90.0%)
  Simulation 1000 of 1000 (100.0%)
Processing prior 2 of 3: p = 0.500000
  Simulation 100 of 1000 (10.0%)
  Simulation 200 of 1000 (20.0%)
  Simulation 300 of 1000 (30.0%)
  Simulation 400 of 1000 (40.0%)
  Simulation 500 of 1000 (50.0%)
  Simulation 600 of 1000 (60.0%)
  Simulation 700 of 1000 (70.0%)
  Simulation 800 of 1000 (80.0%)
  Simulation 900 of 1000 (90.0%)
  Simulation 1000 of 1000 (100.0%)
Processing prior 3 of 3: p = 0.800000
  Simulation 100 of 1000 (10.0%)
  Simulation 200 of 1000 (20.0%)
  Simulation 300 of 1000 (30.0%)
  Simulation 400 of 1000 (40.0%)
  Simulation 500 of 1000 (50.0%)
  Simulation 600 of 1000 (60.0%)
  Simulation 700 of 1000 (70.0%)
  Simulation 800 of 1000 (80.0%)
  Simulation 900 of 1000 (90.0%)
  Simulation 1000 of 1000 (100.0%)</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>standard_results <span class="ot">&lt;-</span> sim_results<span class="sc">$</span>standard</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>forced_results <span class="ot">&lt;-</span> sim_results<span class="sc">$</span>forced</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>trial_df <span class="ot">&lt;-</span> sim_results<span class="sc">$</span>trial_df</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Save results if desired</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(sim_results, <span class="st">"simulation_results.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display simulation summary statistics</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"========== SIMULATION RESULTS ==========</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>========== SIMULATION RESULTS ==========</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">display_results_table</span>(standard_results, config)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Number of trials num_trials=6

===== p = 0.2 =====
  perfect         =&gt; ex-ante=1.0000, ex-post-type=0.8335, ex-post-payoff=0.6313
  conservative    =&gt; ex-ante=0.9208, ex-post-type=0.8067, ex-post-payoff=0.6268
  prior_only      =&gt; ex-ante=0.9075, ex-post-type=0.7960, ex-post-payoff=0.6238
  myopic          =&gt; ex-ante=0.7610, ex-post-type=0.7155, ex-post-payoff=0.5853
  low_memory      =&gt; ex-ante=0.9075, ex-post-type=0.7960, ex-post-payoff=0.6238
  naive_prior     =&gt; ex-ante=0.5868, ex-post-type=0.7172, ex-post-payoff=0.5836

===== p = 0.5 =====
  perfect         =&gt; ex-ante=1.0000, ex-post-type=0.7080, ex-post-payoff=0.5813
  conservative    =&gt; ex-ante=1.0000, ex-post-type=0.7080, ex-post-payoff=0.5813
  prior_only      =&gt; ex-ante=0.2847, ex-post-type=0.5000, ex-post-payoff=0.5000
  myopic          =&gt; ex-ante=0.7850, ex-post-type=0.6643, ex-post-payoff=0.5618
  low_memory      =&gt; ex-ante=0.7850, ex-post-type=0.6643, ex-post-payoff=0.5618
  naive_prior     =&gt; ex-ante=1.0000, ex-post-type=0.7080, ex-post-payoff=0.5813

===== p = 0.8 =====
  perfect         =&gt; ex-ante=1.0000, ex-post-type=0.8543, ex-post-payoff=0.6333
  conservative    =&gt; ex-ante=0.9222, ex-post-type=0.8285, ex-post-payoff=0.6288
  prior_only      =&gt; ex-ante=0.9083, ex-post-type=0.8170, ex-post-payoff=0.6263
  myopic          =&gt; ex-ante=0.7675, ex-post-type=0.7222, ex-post-payoff=0.5922
  low_memory      =&gt; ex-ante=0.9083, ex-post-type=0.8170, ex-post-payoff=0.6263
  naive_prior     =&gt; ex-ante=0.5992, ex-post-type=0.7283, ex-post-payoff=0.5877</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Performance by prior probability</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"STANDARD PERFORMANCE BY PRIOR PROBABILITY</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>STANDARD PERFORMANCE BY PRIOR PROBABILITY</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_performance_by_prior</span>(standard_results, config, <span class="st">"simulation"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: A numeric `legend.position` argument in `theme()` was deprecated in ggplot2
3.5.0.
ℹ Please use the `legend.position.inside` argument of `theme()` instead.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="cognitive_forcing_0.5_files/figure-html/simulation-performance-plot-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="cognitive_forcing_0.5_files/figure-html/simulation-performance-plot-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Performance across trials</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"ACCURACY ACROSS TRIALS</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>ACCURACY ACROSS TRIALS</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_combined_accuracy_by_trial</span>(trial_df, config)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="cognitive_forcing_0.5_files/figure-html/trial-performance-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="cognitive_forcing_0.5_files/figure-html/trial-performance-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Forced choice results (excluding EV ties)</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"========== FORCED CHOICE RESULTS ==========</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>========== FORCED CHOICE RESULTS ==========</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">display_forced_choice_results</span>(forced_results, config)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
===== FORCED CHOICE ACCURACY (EXCLUDING EV TIES) =====
Prior p = 0.2
  perfect         =&gt; ex-ante=1.0000, ex-post-type=0.8335, ex-post-payoff=0.6313 (using 100.0% of trials)
  conservative    =&gt; ex-ante=0.9208, ex-post-type=0.8067, ex-post-payoff=0.6268 (using 100.0% of trials)
  prior_only      =&gt; ex-ante=0.9075, ex-post-type=0.7960, ex-post-payoff=0.6238 (using 100.0% of trials)
  myopic          =&gt; ex-ante=0.7610, ex-post-type=0.7155, ex-post-payoff=0.5853 (using 100.0% of trials)
  low_memory      =&gt; ex-ante=0.9075, ex-post-type=0.7960, ex-post-payoff=0.6238 (using 100.0% of trials)
  naive_prior     =&gt; ex-ante=0.5868, ex-post-type=0.7173, ex-post-payoff=0.5836 (using 100.0% of trials)

Prior p = 0.5
  perfect         =&gt; ex-ante=1.0000, ex-post-type=0.7908, ex-post-payoff=0.6137 (using 71.5% of trials)
  conservative    =&gt; ex-ante=1.0000, ex-post-type=0.7908, ex-post-payoff=0.6137 (using 71.5% of trials)
  prior_only      =&gt; ex-ante=0.0000, ex-post-type=0.5000, ex-post-payoff=0.5000 (using 71.5% of trials)
  myopic          =&gt; ex-ante=0.8644, ex-post-type=0.7274, ex-post-payoff=0.5853 (using 71.5% of trials)
  low_memory      =&gt; ex-ante=0.8644, ex-post-type=0.7274, ex-post-payoff=0.5853 (using 71.5% of trials)
  naive_prior     =&gt; ex-ante=1.0000, ex-post-type=0.7908, ex-post-payoff=0.6137 (using 71.5% of trials)

Prior p = 0.8
  perfect         =&gt; ex-ante=1.0000, ex-post-type=0.8543, ex-post-payoff=0.6333 (using 100.0% of trials)
  conservative    =&gt; ex-ante=0.9222, ex-post-type=0.8285, ex-post-payoff=0.6288 (using 100.0% of trials)
  prior_only      =&gt; ex-ante=0.9083, ex-post-type=0.8170, ex-post-payoff=0.6263 (using 100.0% of trials)
  myopic          =&gt; ex-ante=0.7675, ex-post-type=0.7222, ex-post-payoff=0.5922 (using 100.0% of trials)
  low_memory      =&gt; ex-ante=0.9083, ex-post-type=0.8170, ex-post-payoff=0.6263 (using 100.0% of trials)
  naive_prior     =&gt; ex-ante=0.5992, ex-post-type=0.7283, ex-post-payoff=0.5877 (using 100.0% of trials)</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Forced choice visualization</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_performance_by_prior</span>(forced_results, config, <span class="st">"forced"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="cognitive_forcing_0.5_files/figure-html/forced-choice-results-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="cognitive_forcing_0.5_files/figure-html/forced-choice-results-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the analytical solution</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>analytical_res <span class="ot">&lt;-</span> <span class="fu">run_analytical_core</span>(config)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Calculating analytical solution...
This will enumerate 2^6 = 64 possible sequences
Calculating analytical solution for p=0.2
  Processing sequence 1 of 64 (1.6%)
  Processing sequence 10 of 64 (15.6%)
  Processing sequence 20 of 64 (31.2%)
  Processing sequence 30 of 64 (46.9%)
  Processing sequence 40 of 64 (62.5%)
  Processing sequence 50 of 64 (78.1%)
  Processing sequence 60 of 64 (93.8%)
  Processing sequence 64 of 64 (100.0%)
Calculating analytical solution for p=0.5
  Processing sequence 1 of 64 (1.6%)
  Processing sequence 10 of 64 (15.6%)
  Processing sequence 20 of 64 (31.2%)
  Processing sequence 30 of 64 (46.9%)
  Processing sequence 40 of 64 (62.5%)
  Processing sequence 50 of 64 (78.1%)
  Processing sequence 60 of 64 (93.8%)
  Processing sequence 64 of 64 (100.0%)
Calculating analytical solution for p=0.8
  Processing sequence 1 of 64 (1.6%)
  Processing sequence 10 of 64 (15.6%)
  Processing sequence 20 of 64 (31.2%)
  Processing sequence 30 of 64 (46.9%)
  Processing sequence 40 of 64 (62.5%)
  Processing sequence 50 of 64 (78.1%)
  Processing sequence 60 of 64 (93.8%)
  Processing sequence 64 of 64 (100.0%)</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>analytical_results <span class="ot">&lt;-</span> analytical_res<span class="sc">$</span>standard_results</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>analytical_forced_results <span class="ot">&lt;-</span> analytical_res<span class="sc">$</span>forced_results</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Save results if desired</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(analytical_res, <span class="st">"analytical_results.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display analytical results</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"========== ANALYTICAL RESULTS ==========</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>========== ANALYTICAL RESULTS ==========</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">display_results_table</span>(analytical_results, config)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Number of trials num_trials=6

===== p = 0.2 =====
  perfect         =&gt; ex-ante=1.0000, ex-post-type=0.8362, ex-post-payoff=0.6345
  conservative    =&gt; ex-ante=0.9170, ex-post-type=0.8122, ex-post-payoff=0.6249
  prior_only      =&gt; ex-ante=0.9020, ex-post-type=0.8000, ex-post-payoff=0.6200
  myopic          =&gt; ex-ante=0.7631, ex-post-type=0.7167, ex-post-payoff=0.5867
  low_memory      =&gt; ex-ante=0.9020, ex-post-type=0.8000, ex-post-payoff=0.6200
  naive_prior     =&gt; ex-ante=0.5881, ex-post-type=0.7175, ex-post-payoff=0.5870

===== p = 0.5 =====
  perfect         =&gt; ex-ante=1.0000, ex-post-type=0.7175, ex-post-payoff=0.5870
  conservative    =&gt; ex-ante=1.0000, ex-post-type=0.7175, ex-post-payoff=0.5870
  prior_only      =&gt; ex-ante=0.2808, ex-post-type=0.5000, ex-post-payoff=0.5000
  myopic          =&gt; ex-ante=0.7882, ex-post-type=0.6667, ex-post-payoff=0.5667
  low_memory      =&gt; ex-ante=0.7882, ex-post-type=0.6667, ex-post-payoff=0.5667
  naive_prior     =&gt; ex-ante=1.0000, ex-post-type=0.7175, ex-post-payoff=0.5870

===== p = 0.8 =====
  perfect         =&gt; ex-ante=1.0000, ex-post-type=0.8362, ex-post-payoff=0.6345
  conservative    =&gt; ex-ante=0.9170, ex-post-type=0.8122, ex-post-payoff=0.6249
  prior_only      =&gt; ex-ante=0.9020, ex-post-type=0.8000, ex-post-payoff=0.6200
  myopic          =&gt; ex-ante=0.7631, ex-post-type=0.7167, ex-post-payoff=0.5867
  low_memory      =&gt; ex-ante=0.9020, ex-post-type=0.8000, ex-post-payoff=0.6200
  naive_prior     =&gt; ex-ante=0.5881, ex-post-type=0.7175, ex-post-payoff=0.5870</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Analytical performance visualization</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_performance_by_prior</span>(analytical_results, config, <span class="st">"analytical"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="cognitive_forcing_0.5_files/figure-html/analytical-results-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="cognitive_forcing_0.5_files/figure-html/analytical-results-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Analytical forced choice results</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"========== ANALYTICAL FORCED CHOICE RESULTS ==========</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>========== ANALYTICAL FORCED CHOICE RESULTS ==========</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">display_forced_choice_results</span>(analytical_forced_results, config)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
===== FORCED CHOICE ACCURACY (EXCLUDING EV TIES) =====
Prior p = 0.2
  perfect         =&gt; ex-ante=1.0000, ex-post-type=0.8362, ex-post-payoff=0.6345 (using 100.0% of trials)
  conservative    =&gt; ex-ante=0.9170, ex-post-type=0.8122, ex-post-payoff=0.6249 (using 100.0% of trials)
  prior_only      =&gt; ex-ante=0.9020, ex-post-type=0.8000, ex-post-payoff=0.6200 (using 100.0% of trials)
  myopic          =&gt; ex-ante=0.7631, ex-post-type=0.7167, ex-post-payoff=0.5867 (using 100.0% of trials)
  low_memory      =&gt; ex-ante=0.9020, ex-post-type=0.8000, ex-post-payoff=0.6200 (using 100.0% of trials)
  naive_prior     =&gt; ex-ante=0.5881, ex-post-type=0.7175, ex-post-payoff=0.5870 (using 100.0% of trials)

Prior p = 0.5
  perfect         =&gt; ex-ante=1.0000, ex-post-type=0.8024, ex-post-payoff=0.6210 (using 71.9% of trials)
  conservative    =&gt; ex-ante=1.0000, ex-post-type=0.8024, ex-post-payoff=0.6210 (using 71.9% of trials)
  prior_only      =&gt; ex-ante=0.0000, ex-post-type=0.5000, ex-post-payoff=0.5000 (using 71.9% of trials)
  myopic          =&gt; ex-ante=0.8642, ex-post-type=0.7317, ex-post-payoff=0.5927 (using 71.9% of trials)
  low_memory      =&gt; ex-ante=0.8642, ex-post-type=0.7317, ex-post-payoff=0.5927 (using 71.9% of trials)
  naive_prior     =&gt; ex-ante=1.0000, ex-post-type=0.8024, ex-post-payoff=0.6210 (using 71.9% of trials)

Prior p = 0.8
  perfect         =&gt; ex-ante=1.0000, ex-post-type=0.8362, ex-post-payoff=0.6345 (using 100.0% of trials)
  conservative    =&gt; ex-ante=0.9170, ex-post-type=0.8122, ex-post-payoff=0.6249 (using 100.0% of trials)
  prior_only      =&gt; ex-ante=0.9020, ex-post-type=0.8000, ex-post-payoff=0.6200 (using 100.0% of trials)
  myopic          =&gt; ex-ante=0.7631, ex-post-type=0.7167, ex-post-payoff=0.5867 (using 100.0% of trials)
  low_memory      =&gt; ex-ante=0.9020, ex-post-type=0.8000, ex-post-payoff=0.6200 (using 100.0% of trials)
  naive_prior     =&gt; ex-ante=0.5881, ex-post-type=0.7175, ex-post-payoff=0.5870 (using 100.0% of trials)</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Analytical forced choice visualization</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_performance_by_prior</span>(analytical_forced_results, config, <span class="st">"analytical_forced"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="cognitive_forcing_0.5_files/figure-html/analytical-forced-choice-results-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="cognitive_forcing_0.5_files/figure-html/analytical-forced-choice-results-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>